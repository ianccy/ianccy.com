{"componentChunkName":"component---src-templates-post-tsx","path":"/nodestart/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu"}},"markdownRemark":{"id":"56aa8594-3828-56c6-87d0-dbceb43bda91","excerpt":"一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby…","html":"<p>一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby…等等。</p>\n<p>在這個前後端分離的時代，多半會再開一台 Node.js 的 server 給前端處理 router，如果有使用到 javascript framework(react、vue、angular)，就會需要 server side render，在這邊一同處理畫面跟資料的渲染，而原本的後端則單純負責 api 建立。</p>\n<p>這邊就要來使用 Node.js 搭配 express 以及 MySQL 來建立簡單的網站 router。</p>\n<h2 id=\"express-建立-router\" style=\"position:relative;\"><a href=\"#express-%E5%BB%BA%E7%AB%8B-router\" aria-label=\"express 建立 router permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>express 建立 router</h2>\n<p>1.首先建立資料夾、建立 package.json</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create folder and movein create package.json</span>\nmkdir node<span class=\"token operator\">-</span>express\ncd node<span class=\"token operator\">-</span>express\nnpm init <span class=\"token operator\">-</span>y\n\n<span class=\"token comment\">//install express</span>\nnpm install express <span class=\"token operator\">--</span>save</code></pre></div>\n<p>2.建立 app.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// use express method</span>\n<span class=\"token keyword\">var</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// use express get method</span>\n<span class=\"token comment\">// create root router and print hello world</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// check running enviroment</span>\n<span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// create</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// only print hint link for local enviroment</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>port <span class=\"token operator\">===</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"RUN http://localhost:3000/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"http://expressjs.com/zh-tw/4x/api.html#app.get.method\" title=\"express get\">express get</a>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.listen\" title=\"express listen\">express listen</a>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.METHOD\" title=\"express METHOD\">express METHOD</a></p>\n<p>3.執行 app.js、打開 <a href=\"http://localhost:3000/\">http://localhost:3000/</a>\n打開 command 輸入 node app.js 執行檔案</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">node app<span class=\"token punctuation\">.</span>js</code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 615px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXElEQVQoz+XNPQ6AIAxA4d7/emy1DJKQQFEaYmFwEBMv4A+j3/7yIITgvceJyFoiMsYg4uxcFsl3YEmJI3PkWpuqllJ009ba/gCIyLpmrbW/B30AHJeP8dD5h/EJavBNrbyYP5sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/a805d/nodehello.webp 495w,\n/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/3fce0/nodehello.webp 615w\"\n              sizes=\"(max-width: 615px) 100vw, 615px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/b3db0/nodehello.png 495w,\n/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png 615w\"\n            sizes=\"(max-width: 615px) 100vw, 615px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png\"\n            alt=\"node hello world\"\n            title=\"node hello world\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">node hello world</figcaption>\n  </figure>\n成功看到了 Hello world，這樣就建立了一個很簡易的 node server。但這邊印出來的 hello world，只是純粹字串，不具備 html 架構。</p>\n<p>4.建立對應 html 檔案搭配動態 router</p>\n<p>這邊用到的是 ejs template，方便我們之後取用 node.js 傳遞的資料。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// install ejs</span>\nnpm install ejs<span class=\"token operator\">-</span>locals <span class=\"token operator\">--</span>save</code></pre></div>\n<p>建立 ejs 相對應的檔案。\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01010101010101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY043Q2WrDMBAFUP1KLY32kSxrsSLZNU4pKVme+v//UkIgD6GFDudtmMtlSF/79r5pra21iNZaG6aQp7jmaWnNOZ9zQufQOkSUUj1Yi957Ms/1cr62toSQ7sYIQh18OOZxDCMIwShQygbKKGWMAQBnDLSxznlSynw6fbXWrMWYUoyJCzkZd+v5+zp/npdtz30r72uoa0yHgKPxE3IhKWUkxrTvH8ZYKbUxaLRlXGQXjrWVucQUSy05Rm+01EopxbngXABwAE5aO1yut1KbH+Odn7hUNcR9XXIvtfe+bEbjMNw7P2o/Ee+x1moRHzvGgEuVfAhGvbEBODAASunw2xAh5DDQl8j7VwCecX8hUqqXs//7ARJJUvk2B5YzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8677fc536c06dd2ff9a53ac568370575/a805d/filestru.webp 495w,\n/static/8677fc536c06dd2ff9a53ac568370575/6ec60/filestru.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8677fc536c06dd2ff9a53ac568370575/b3db0/filestru.png 495w,\n/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png\"\n            alt=\"file structure\"\n            title=\"file structure\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">file structure</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create ejs</span>\n<span class=\"token keyword\">var</span> engine <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ejs-locals'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">engine</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ejs'</span><span class=\"token punctuation\">,</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'files'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'./files'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'view engine'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ejs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">// modify router use file name</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/about'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'about'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>輸入完成一樣執行 node app.js，就完成有對應檔案的 router。\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.18181818181818%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVQoz8WNTU+DQBCG9///Gz1V7UILJLaJjWhahYUqFPaDnd3ZYhNvBQMaLx6apgefTOYwM8+8ZLqYXPtXd/SWep4/my3vo/nM930/CILFyJRSj3pRFMVxHAYBpV4QRqtwHt1MCOc82zKW5i9Pa5YyXtUIWgMYY5xziAgABgARrbXWDIAxDi0aSw6HD7RQv2H7rtE6zeGzaazbt22rpJIjGkApmWWZEKJpmt2uGlZKkYfVY1GUm816kyRCiCRNyrLIszx5TftTEC5rt0elVaOVNaaua4dWCskYOx67vu+77qf/haQxz5/FellUWzOenQHhhVU7rHJtZDskjNPvx6fl/gLIkPVbZ8sXJf+X/AVT5qr1AFBZygAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/a805d/nodedemo.webp 495w,\n/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/e28c4/nodedemo.webp 750w\"\n              sizes=\"(max-width: 750px) 100vw, 750px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/b3db0/nodedemo.png 495w,\n/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png 750w\"\n            sizes=\"(max-width: 750px) 100vw, 750px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png\"\n            alt=\"nodedemo\"\n            title=\"nodedemo\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">nodedemo</figcaption>\n  </figure></p>\n<p><a href=\"http://expressjs.com/zh-tw/starter/static-files.html\" title=\"express static\">express static</a></p>\n<h2 id=\"串接-mysql\" style=\"position:relative;\"><a href=\"#%E4%B8%B2%E6%8E%A5-mysql\" aria-label=\"串接 mysql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>串接 MySQL</h2>\n<p>再來讓我們試著串接 MySQL，做一個完整的後端服務。如果你的電腦沒有安裝 MySQL，要記得先安裝好，<a href=\"https://dev.mysql.com/doc/refman/5.7/en/osx-installation-pkg.html\" title=\"mac 安裝 mysql 教學\">mac 安裝 mysql 教學</a>、<a href=\"https://jerrynest.io/windows-mysql-installer/\" title=\"windwos 安裝 mysql 教學\">windwos 安裝 mysql 教學</a>。\nps.mysql 記得安裝 5.7 以下版本，剛剛跑一遍下載到 8.0.x 版本的，sequel pro 連接出一堆問題，也許是不支援新版的。</p>\n<p>1.安裝 MySQL for node.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// install MySQL tool</span>\nnpm install mysql <span class=\"token operator\">--</span>save</code></pre></div>\n<p><a href=\"http://expressjs.com/zh-tw/guide/database-integration.html#mysql\" title=\"express with mysql\">express with mysql</a>\n<a href=\"https://github.com/mysqljs/mysql\" title=\"node.js mysql\">node.js mysql</a></p>\n<p>2.在 MySQL 建立資料、透過 express 連接 sql\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.08080808080808%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQY023M206DQBAGYN7/Ybww2ii2jaknaASKbHfZLUhAYDkFurttLIMXptYmxPjlT2YmfzJaWka8KKq6iZi9XruGu0E4JDRwvTeKHm/vdIQQpZQxFo8kSVIUhUYQWTkOY+x1uZjNZ5Pp4ul5aRiGaRqWeX89ufKQFwQBpdT3fYwxIeS0eJ6n6ZcXD/rNy3yaxEme84845jxP0zTLsrJq2h9N00gplVJd1wkhlFJKKiGFhmwL2RZeOUpKANhuT52s67qqyrZtd/s957w7PukA4GtEi9+jkLLQpzupAAboAY5jAID+bBiG/j9aSDcUkw0mUoi+7w+fh9+M/TnPvgGYokNXTCeV+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ef4cc874ae00935d8403dd823f77350e/a805d/sqldata.webp 495w,\n/static/ef4cc874ae00935d8403dd823f77350e/6ec60/sqldata.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ef4cc874ae00935d8403dd823f77350e/b3db0/sqldata.png 495w,\n/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png\"\n            alt=\"sqldata\"\n            title=\"sqldata\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">sqldata</figcaption>\n  </figure>\n在剛剛建立的 app.js 上面建立</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">var</span> mysql      <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mysql'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// connect MySQL</span>\n<span class=\"token keyword\">var</span> connection <span class=\"token operator\">=</span> mysql<span class=\"token punctuation\">.</span><span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">host</span>     <span class=\"token operator\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">user</span>     <span class=\"token operator\">:</span> <span class=\"token string\">'root'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">password</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">database</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// select MyGuests table and print all colums</span>\nconnection<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'select * from MyGuests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">,</span> fields</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The solution is: '</span><span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>執行 node app.js 會看到印出資料，這樣就成功地在 express 連接到 MySQL 了，接下來就要把這個資料加到 express 的 router 中，讓我們在頁面中可以使用資料</p>\n<p>3.把剛剛 sql 的資料設定到 about page</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create object</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconnection<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from MyGuests\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">,</span> fields</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// set data to object</span>\n  data<span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/about\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// add data property to about page</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"about\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>4.修改 about.ejs 使用設定的 data</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>Name<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>id <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>firstname<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>firstname <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>lastname<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>lastname <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>email<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>email <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>registert date<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>reg_date <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span></code></pre></div>\n<p>5.執行檔案\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 708px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.23232323232323%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVQoz52S206EMBBA+f9fUv/B3eUmtHQ6My2XAiKXsGKymGWNPnnB8zTN5OQ8dLyyLJUCAExjkcYJIlut27adpmkYhnEch43b0HXd7dn3/TiOXu1q5yqQFk95pzFSeRM9MZE1OSFaY5UCRLLWImIQhFprIpJSMhsvU5lhY62Rmexe+nVdL5fL+je8MAjSJPVP/v3dg7X2Z/lzdRs8kYque94V/CprrZ1z0zTN87xbTlMhhQyDMLf53r6nsgwRNei2aXeXQSlmBtDMZp7n1yvL28blez5kISSAjuL4cDweDo9xHIV+KFJRVdXvZSEEEjExKCCi2tVFUTCzFNczUJmSmUIktW2TJOHtQs7n81X2g0hrKvJcKWCisqxq59qmYeaiLJmJ2BhjmNkaAwBFURhjlmW5ym05Dt38v39+B1Nl45ssdTpXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f7d2ede723788d1d62973a0f7aeba181/a805d/expressdata.webp 495w,\n/static/f7d2ede723788d1d62973a0f7aeba181/765e0/expressdata.webp 708w\"\n              sizes=\"(max-width: 708px) 100vw, 708px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f7d2ede723788d1d62973a0f7aeba181/b3db0/expressdata.png 495w,\n/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png 708w\"\n            sizes=\"(max-width: 708px) 100vw, 708px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png\"\n            alt=\"expressdata\"\n            title=\"expressdata\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">expressdata</figcaption>\n  </figure></p>\n<p>會發現到頁面拿到了 MySQL 的資料，這樣就完成了很基本的一個後端架構。</p>\n<p><a href=\"https://github.com/Ianpig/work/tree/nodeexpre\" title=\"source code\">source code</a></p>\n<h2 id=\"部署-heroku\" style=\"position:relative;\"><a href=\"#%E9%83%A8%E7%BD%B2-heroku\" aria-label=\"部署 heroku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>部署 Heroku</h2>\n<p>再來把剛剛寫好的 node.js 部署到網路上面，heroku 有免費使用的方案，所以這邊使用的是 heroku。</p>\n<p>首先要安裝 heroku cli，再來註冊帳號，在專案內的 package.json 加入”start”: “node app.js”，新增檔案 Procfile。</p>\n<p><a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction\" title=\"heroku node deploy 教學\">heroku node deploy 教學</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// file package.json</span>\n\n  <span class=\"token string-property property\">\"engines\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.2.2\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node app.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token comment\">// file Procfile</span>\n<span class=\"token literal-property property\">web</span><span class=\"token operator\">:</span> node app<span class=\"token punctuation\">.</span>js\n</code></pre></div>\n<p>開始準備部署作業</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//login account</span>\nheroku login\n\n<span class=\"token comment\">//use git</span>\ngit init\ngit add <span class=\"token punctuation\">.</span>\ngit commit <span class=\"token operator\">-</span>m <span class=\"token string\">\"init node\"</span>\n\n<span class=\"token comment\">// create heroku repo</span>\nheroku create\n\n<span class=\"token comment\">// push remote</span>\ngit push heroku master\n\nheroku ps<span class=\"token operator\">:</span>scale web<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\nheroku open\n</code></pre></div>\n<p>完成部署之後就可以看到剛剛的內容了。</p>\n<p>實際上檔案架構應該要分離，這邊為了快速 demo 以及簡單化，所以全部操作都寫在一個檔案，應該要分離 router、MySQL 的邏輯，然後引入其他工具方便我們操作。讓架構比較清楚也比較好管理。日後再好好的處理一版。</p>\n<p>之後應該會考慮用 mongoDB，不用人人本地端要安裝 MySQL。然後寫 api 做出 CRUD，再搭配 node.js 或是 next 做 Server side render。</p>\n<!--- ![node.js](../images/node.png \"node.js\") --->\n","fields":{"readingTime":{"text":"6 min read"}},"frontmatter":{"title":"Node.js、Express、MySQL串接資料庫，Heroku部署環境","date":"June 17, 2018","description":"在這個前後端分離的時代，多半會再開一台Node.js的server給前端處理router，這邊就要來使用Node.js搭配express以及MySQL來建立簡單的網站router。","categories":"javascript","tags":["node.js"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/f7d2ede723788d1d62973a0f7aeba181/a444c/expressdata.png","srcSet":"/static/f7d2ede723788d1d62973a0f7aeba181/5481b/expressdata.png 177w,\n/static/f7d2ede723788d1d62973a0f7aeba181/16e27/expressdata.png 354w,\n/static/f7d2ede723788d1d62973a0f7aeba181/a444c/expressdata.png 708w","sizes":"(min-width: 708px) 708px, 100vw"},"sources":[{"srcSet":"/static/f7d2ede723788d1d62973a0f7aeba181/eef78/expressdata.webp 177w,\n/static/f7d2ede723788d1d62973a0f7aeba181/e3340/expressdata.webp 354w,\n/static/f7d2ede723788d1d62973a0f7aeba181/2e1e5/expressdata.webp 708w","type":"image/webp","sizes":"(min-width: 708px) 708px, 100vw"}]},"width":1280,"height":809.9435028248588}}},"image":{"publicURL":"/static/f7d2ede723788d1d62973a0f7aeba181/expressdata.png"}}},"previous":{"fields":{"slug":"/2018-05-fbvotify/"},"frontmatter":{"title":"Facebook 粉絲團網域驗證教學"}},"next":{"fields":{"slug":"/2018-06-gautm/"},"frontmatter":{"title":"Google analytics UTM設定參數，追蹤facebook廣告、簡訊、EDM"}}},"pageContext":{"id":"56aa8594-3828-56c6-87d0-dbceb43bda91","previousPostId":"6aea7088-7cbe-5318-9137-3a23bd82b596","nextPostId":"bafe289c-b127-5e01-8eee-ea2daab96ea8"}},"staticQueryHashes":["3649515864","3761976949","441988385"]}