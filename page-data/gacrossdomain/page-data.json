{"componentChunkName":"component---src-templates-post-tsx","path":"/gacrossdomain/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu"}},"markdownRemark":{"id":"b9e9b42c-f0a6-5f5e-bd77-d68dc62fea15","excerpt":"如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。或許你現在還沒遇到，但我來舉個例子讓你理解問題怎麼發生。 情境假設，你今天操作 google ads 的 landing page 是 example.com，但是使用者後續造訪頁面是 buyservice.com…","html":"<p>如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。或許你現在還沒遇到，但我來舉個例子讓你理解問題怎麼發生。</p>\n<p>情境假設，你今天操作 google ads 的 landing page 是 example.com，但是使用者後續造訪頁面是 buyservice.com，你的 buyservice.com 上 google analytics 數據就會有問題，會在報表看到使用者的 <code class=\"language-text\">參考來源</code> 會是 example.com，而不是 google ads ，這樣就會無法正確估算 example.com 帶給 buyservice.com 的廣告效益。</p>\n<p>這是因為 google analytics 數據是依賴 cookie 做定位使用者 (Client-ID)，但是 cookie 有個限制， 同一個 cookie 只能在同 domain 下共同享有，所以跨網域就會斷掉追蹤數據，但還好 google analytics 有提供 <code class=\"language-text\">跨網域追蹤</code> 功能，讓我們解決這個問題。後面就來嘗試跨網域追蹤設定。</p>\n<p>官方教學: <a href=\"https://support.google.com/analytics/answer/1034342?hl=zh-Hant\" title=\"設定跨網域追蹤 (analytics.js)\">設定跨網域追蹤 (analytics.js)</a></p>\n<h2 id=\"google-analytics-追蹤碼修改\" style=\"position:relative;\"><a href=\"#google-analytics-%E8%BF%BD%E8%B9%A4%E7%A2%BC%E4%BF%AE%E6%94%B9\" aria-label=\"google analytics 追蹤碼修改 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>google analytics 追蹤碼修改</h2>\n<p>需要找出你的 google analytics 設定追蹤碼，再針對 <code class=\"language-text\">ga('create', 'UA-XXXXXXX-Y', '你的網址')</code> 修改，需要改為 auto，並在後面加上 {‘allowLinker’: true} 參數，後面再加上 ｀ ga(‘require’, ‘linker’);｀ ，並加上 <code class=\"language-text\">ga('linker:autoLink', ['相對應的 domain'] )</code>，這樣就完成了設定。</p>\n<h3 id=\"傳統追蹤碼\" style=\"position:relative;\"><a href=\"#%E5%82%B3%E7%B5%B1%E8%BF%BD%E8%B9%A4%E7%A2%BC\" aria-label=\"傳統追蹤碼 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>傳統追蹤碼</h3>\n<ul>\n<li>example.com 修改追蹤碼</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'UA-XXXXXXX-Y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'example.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">對這段程式碼進行下列變更</span> <span class=\"token punctuation\">(</span>紅色粗體文字是需要變更的部分<span class=\"token punctuation\">)</span>：\n\n  <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'UA-XXXXXXX-Y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'allowLinker'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'require'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'linker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'linker:autoLink'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'buyservice.com'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>buyservice.com 修改追蹤碼</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UA-XXXXXXX-Y\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"auto\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">allowLinker</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"require\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"linker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"linker:autoLink\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"example.com\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"tag-manager-追蹤碼\" style=\"position:relative;\"><a href=\"#tag-manager-%E8%BF%BD%E8%B9%A4%E7%A2%BC\" aria-label=\"tag manager 追蹤碼 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tag manager 追蹤碼</h3>\n<p>如果你是用 tag manager 設定 google analytics 的話，在 google analaytics 追增設定內的欄位設定(Field)，再增加 allowLinker 值 true，自動連結網址就填上要連動的網域。這樣就完成 tag manager 的設定了。記得 tag manager 的改動要提交更新。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a5d3a0bb71ead92b824f79678b84214/acfc1/gacrossdomaintagmanager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVR42o2SUW7EMAhEc/+jdpOujXHAhnGqtaM2jZJ2R/6xxBPDwFRKCSEQUexiTqra7uWAA6tINZtSXolzTKxaaq3uvt2rtUbMMb1e4jwNMlAqXar6XQrA3VvbsaFrWEsxMxVpvdzMErOIABjfdRWgUbqBHS1yHfAftgMl4vxYPs+dzfxo28wu4ZTXj8d8gPu0WmGObWvuGBEAeIXsXqsB+IHn+WQbMR9739ru8PI7bdVSyr+rurLdZ35nzyExcV6eYYefe+ciIu8cSTiuasBWa4wkXaecLy/sC5SEvRYgR9bWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6a5d3a0bb71ead92b824f79678b84214/a805d/gacrossdomaintagmanager.webp 495w,\n/static/6a5d3a0bb71ead92b824f79678b84214/6ec60/gacrossdomaintagmanager.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6a5d3a0bb71ead92b824f79678b84214/b3db0/gacrossdomaintagmanager.png 495w,\n/static/6a5d3a0bb71ead92b824f79678b84214/acfc1/gacrossdomaintagmanager.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6a5d3a0bb71ead92b824f79678b84214/acfc1/gacrossdomaintagmanager.png\"\n            alt=\"google analytics cross domain tagmanager\"\n            title=\"google analytics cross domain tagmanager\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain tagmanager</figcaption>\n  </figure></p>\n<h3 id=\"google-analytics-設定排除參照連結\" style=\"position:relative;\"><a href=\"#google-analytics-%E8%A8%AD%E5%AE%9A%E6%8E%92%E9%99%A4%E5%8F%83%E7%85%A7%E9%80%A3%E7%B5%90\" aria-label=\"google analytics 設定排除參照連結 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>google analytics 設定排除參照連結</h3>\n<p>當一個網站到另一個網站時，google analytics 會自動建立新的工作階段，如果要跨多個網域追蹤單一工作階段，要把相對應網域加進參照連結網址排除清單。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8fc82feb4fb1e889c1f29db3f958f554/acfc1/gacrossdomainsetting.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21212121212122%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3UlEQVR42o2PW07EMAxFu//tsBE+WACi06ZJ2iZ9pHYaP0bpIMEHDBxZlm3pyLrNkVJY0vsAOxAVOs/CLMRCxLXqzLXo6t9X4kaVw4ZvbVlBVcWH9aM3fdeN02StNcZYa/u+d84ZY7rbbRiGx9Fa2+ScEeDEvaoi2578OHnvl2UJFwCAv9CIMCBuWxIRVVnXteuMdc57P45jCOG6/0wjIkQUY+SahBBBpVD5RJ9SZWaeQ+D6ge0ML6/s41EyPoL8IYuwa9t9nuk8D8CUlYifa18yIm4x5uOgUhBR/80dr47R6jLVN4YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8fc82feb4fb1e889c1f29db3f958f554/a805d/gacrossdomainsetting.webp 495w,\n/static/8fc82feb4fb1e889c1f29db3f958f554/6ec60/gacrossdomainsetting.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8fc82feb4fb1e889c1f29db3f958f554/b3db0/gacrossdomainsetting.png 495w,\n/static/8fc82feb4fb1e889c1f29db3f958f554/acfc1/gacrossdomainsetting.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8fc82feb4fb1e889c1f29db3f958f554/acfc1/gacrossdomainsetting.png\"\n            alt=\"google analytics cross domain setting\"\n            title=\"google analytics cross domain setting\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain setting</figcaption>\n  </figure></p>\n<h2 id=\"網址參數-_ga\" style=\"position:relative;\"><a href=\"#%E7%B6%B2%E5%9D%80%E5%8F%83%E6%95%B8-_ga\" aria-label=\"網址參數 _ga permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>網址參數 _ga</h2>\n<p>完成設定之後，就可以測試看看效果如何，下方是完成設定的 demo ，如果你點擊連結 go to <a href=\"https://thawing-stream-74537.herokuapp.com/\">https://thawing-stream-74537.herokuapp.com/</a> 後，會發現網址多一段參數 ?_ga=2.189459235.924386874.1564911255-1438900564.1564911255 ，這就是 google analytics 傳遞 client_id 的參數，依賴這參數可以讓工作階段在跨網域下不中斷。</p>\n<iframe src=\"https://test.ianccy.com/gacrossdomain.html\" width=\"100%\" height=\"400\"></iframe>\n<h2 id=\"共用-google-analytics-追蹤代碼\" style=\"position:relative;\"><a href=\"#%E5%85%B1%E7%94%A8-google-analytics-%E8%BF%BD%E8%B9%A4%E4%BB%A3%E7%A2%BC\" aria-label=\"共用 google analytics 追蹤代碼 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>共用 google analytics 追蹤代碼</h2>\n<p>如果你是分開兩個 google analytics 帳戶，還是會無法延續追蹤資訊，只能共用 client_id ，但這意義不大，因為通常 client_id 都會設定成會員 id，所以網站通常都會共用 client_id，所以我們要再多額外開一個檢視資料，產生一組新的追蹤代碼，讓兩個互相跨 domain 網站共用。</p>\n<ul>\n<li>\n<p>載入 <a href=\"https://test.ianccy.com/gacrossdomain.html?utm_source=google&#x26;utm_medium=cpc&#x26;utm_campaign=weekend_sale01\">https://test.ianccy.com/gacrossdomain.html?utm_source=google&#x26;utm_medium=cpc&#x26;utm_campaign=weekend_sale01</a> utm 數據\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0klEQVR42n2QTUsDMRCG8///j+C1tCB46lHw4M1a6yabTJL5yiSyu0UqSh/ew8vMM5dxx9evh+fL/kXeztxNiYRZRFREmeV+HFFtSmMMRCRaym3v/6GqZq337sz6duCniRC3bis/tq25MgYxb1tHzZL2OsYlQUCqfRRblRvUOrfrSPvIyJvhPpEfT3EX6sGXQyj7GZ8iZtZMmlASCpBE5IgMKIASUeZcRbSZueD9x/tpjgkgl1zyCkCefIgpJYC/AViEGKNDYqLlv/ybUpCI7wAA3zBslcxQMhbaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4d8908976503cca984d11a60243dc691/a805d/gacrossdomainview.webp 495w,\n/static/4d8908976503cca984d11a60243dc691/6ec60/gacrossdomainview.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4d8908976503cca984d11a60243dc691/b3db0/gacrossdomainview.png 495w,\n/static/4d8908976503cca984d11a60243dc691/acfc1/gacrossdomainview.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4d8908976503cca984d11a60243dc691/acfc1/gacrossdomainview.png\"\n            alt=\"google analytics cross domain view data\"\n            title=\"google analytics cross domain setting\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain setting</figcaption>\n  </figure></p>\n</li>\n<li>\n<p>載入連結後 <a href=\"https://thawing-stream-74537.herokuapp.com\">https://thawing-stream-74537.herokuapp.com</a> 數據\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.95959595959596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVR42o2QMU8DMQyF8/9/FQNFRSyFMrAwVQJEucs5TmI7qWN0ueupAwOfLMtP8nOi517e/cMbSlmRf8MsrlZpWs0s58zM1iEiETGz9he1VlVtrbm5d8PPMBLLYtbOtq3abpQxy2q+iGjwliCdv2Q8W4SGYKp2Q9Eml7beNQuZrb/oePiGpzs63PNxL8e9PO/K66MwBa6BJFBBKkBlGbAPkKj0r7vB+9PH55QopJyIYy9E9H5CxICIMY7eAwBeiRFjjNMEjnkOrizxbTUrXqIvIkRMV7mBGH8BnCKVnWjPM0UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d8238a8c5b39eea5affcbb86b8a4ecea/a805d/gacrossdomainview2.webp 495w,\n/static/d8238a8c5b39eea5affcbb86b8a4ecea/6ec60/gacrossdomainview2.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d8238a8c5b39eea5affcbb86b8a4ecea/b3db0/gacrossdomainview2.png 495w,\n/static/d8238a8c5b39eea5affcbb86b8a4ecea/acfc1/gacrossdomainview2.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d8238a8c5b39eea5affcbb86b8a4ecea/acfc1/gacrossdomainview2.png\"\n            alt=\"google analytics cross domain view data\"\n            title=\"google analytics cross domain setting\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain setting</figcaption>\n  </figure></p>\n</li>\n</ul>\n<p>這樣就發現我們把 utm 的追蹤資訊延續下去了，一般狀況沒設定 cross domain 共享 client_id 的話，會變成兩個 session，因為 cookie 無法共享，但這樣對於追蹤來說，就有非常大的幫助，我們不用在擔心數據掉落的問題。</p>\n<h2 id=\"報表檢視增加-domain\" style=\"position:relative;\"><a href=\"#%E5%A0%B1%E8%A1%A8%E6%AA%A2%E8%A6%96%E5%A2%9E%E5%8A%A0-domain\" aria-label=\"報表檢視增加 domain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>報表檢視增加 domain</h2>\n<p>如果在檢視報表時，沒有顯示 domain 的話，會不方便直觀分辨網址的 domain 問題，因為 google analytics 預設不顯示 domain，我們要在設定增加顯示，以便我們觀看數據。</p>\n<p>點選篩選器 => 自訂 => 進階，分別在前兩個 選擇主機名稱 內容填上 <code class=\"language-text\">(.*)</code>，這代表我們要取全部的 domain name，請求 URI 則是 填上 <code class=\"language-text\">(.*)</code>，取用全部請求網址，後面 輸出至 -> 建構函式 再分別選擇 URI，內容填上 <code class=\"language-text\">$A1$B1</code>，取用前面兩個條件拿到全部值。</p>\n<ul>\n<li>\n<p>google analytics 篩選器設定\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20211067c0d81f713a8d0f556c434f61/acfc1/gacrossdomainsetting3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.41414141414141%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVR42pWSy2rDQAxF/f9f2GWhJIXYMHZH79eUmFK6qicXrQSHg8RdCBkB7xt+bNbJzc09PMLcL2fJKlN5f8jbZ31REkJr+77vVTWusqgqMzNBpVcNAEDEzBwTWTJLRAAxIqsKEY/jmNGecNUpl1Gj8gmv6woA07AIHbu7i4iqImJrLSLqT/4z994zMyJUDQBaa3lecQVnugcihVlmmv3AL5hba+UW8YR779u2EdEUbKoiMsbICHePCAB4wczMvytmvt3uZjbz7Xw+DNGE6uwGIT7WdaZh3yFRw906PfBjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/20211067c0d81f713a8d0f556c434f61/a805d/gacrossdomainsetting3.webp 495w,\n/static/20211067c0d81f713a8d0f556c434f61/6ec60/gacrossdomainsetting3.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/20211067c0d81f713a8d0f556c434f61/b3db0/gacrossdomainsetting3.png 495w,\n/static/20211067c0d81f713a8d0f556c434f61/acfc1/gacrossdomainsetting3.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/20211067c0d81f713a8d0f556c434f61/acfc1/gacrossdomainsetting3.png\"\n            alt=\"google analytics cross domain setting\"\n            title=\"google analytics cross domain setting\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain setting</figcaption>\n  </figure></p>\n</li>\n<li>\n<p>檢視報表\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fc89321edabc19b0bbc553457484795e/acfc1/gacrossdomainview3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.74747474747475%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVR42o2STU/DMAyG+/9/BxIHKnHgwmWoCE58c2BC1QSsG2wtLVrTJHYa20HdhvYt8eg5WXHsN0qkjc1GI9e2RHzIDpHdeoTo8jxHxPCHiIRNvPcANgTZMvJEW+fSNHXOrV/UNE2eFyLCm3TN66OYeb15DdllPlk4MAUmIR9CGGcZGN0tNi8GYUfcEoe9zYsEy7WZZwbQL7Ms6o0j09L2Q5BEHIK+7anzI7o6dUnskhiuzzCJMTnByxh6x/4pQc/oWUSIhbvk3dhcu8i1pIdpcXNRv9yp/r15fWjf++3geWn6SJ8D52lmsdKQK1tbLDV8K6gtRnWtBh/Z29e0ULZQttTwY6AyuLIxZVlW1R4j7/1kMh1mY21srZpaNdYYB7AS0R2g+yQAqC0qbeZaC4D/4xdl5XlC4yvq/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fc89321edabc19b0bbc553457484795e/a805d/gacrossdomainview3.webp 495w,\n/static/fc89321edabc19b0bbc553457484795e/6ec60/gacrossdomainview3.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fc89321edabc19b0bbc553457484795e/b3db0/gacrossdomainview3.png 495w,\n/static/fc89321edabc19b0bbc553457484795e/acfc1/gacrossdomainview3.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fc89321edabc19b0bbc553457484795e/acfc1/gacrossdomainview3.png\"\n            alt=\"google analytics cross domain view data\"\n            title=\"google analytics cross domain view data\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">google analytics cross domain view data</figcaption>\n  </figure></p>\n</li>\n</ul>\n<p>這樣就完成了整個設定，達到了跨網域追蹤的功能！</p>\n<h2 id=\"心得\" style=\"position:relative;\"><a href=\"#%E5%BF%83%E5%BE%97\" aria-label=\"心得 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>心得</h2>\n<p>雖然這跨網域追蹤一直以來都存在著，以前擔任行銷時，可惜沒有使用到這個功能，公司網址包含 blog 的話大概有 6 個，如果都有設定的話，就更能了解轉換的流程。以往都只能在站內連結上加上 utm，被動地去追蹤數據，但假設是 google ads 進來的流量，但到第二個 domain 成效歸屬就被認為是站內連結，模糊了數據的焦點。</p>\n<!--- ![google analytics cross domain tracking](../images/gacrossdomain.png \"google analytics cross domain tracking\") --->\n","fields":{"readingTime":{"text":"7 min read"}},"frontmatter":{"title":"GA跨網域追蹤 google analytics cross-domain tracking","date":"August 04, 2019","description":"如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。google analytics有提供跨網域追蹤，讓我們解決這個問題，後面就來嘗試跨網域追蹤設定。","categories":"marketing","tags":["google_analytics"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/2f32f/gacrossdomain.png","srcSet":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/4ceb4/gacrossdomain.png 297w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/49d41/gacrossdomain.png 595w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/2f32f/gacrossdomain.png 1189w","sizes":"(min-width: 1189px) 1189px, 100vw"},"sources":[{"srcSet":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/5efa1/gacrossdomain.webp 297w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/0bd3f/gacrossdomain.webp 595w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/8a4e1/gacrossdomain.webp 1189w","type":"image/webp","sizes":"(min-width: 1189px) 1189px, 100vw"}]},"width":1280,"height":560.874684608915}}},"image":{"publicURL":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/gacrossdomain.png"}}},"previous":{"fields":{"slug":"/2019-09-jestunit/"},"frontmatter":{"title":"React Unit Test with Jest 單元測試"}},"next":{"fields":{"slug":"/2019-07-reactcontextapi/"},"frontmatter":{"title":"React Context API 跨元件傳遞資料"}}},"pageContext":{"id":"b9e9b42c-f0a6-5f5e-bd77-d68dc62fea15","previousPostId":"a4c18456-e399-59b6-adcd-5c7f7c8be1a7","nextPostId":"627fdf55-94cf-57d2-8ea0-71a491c2a832"}},"staticQueryHashes":["3649515864","3707347541","3761976949"],"slicesMap":{}}