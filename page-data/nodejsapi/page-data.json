{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodejsapi/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"2b6a6665-f9df-5520-b871-e6e794beb61d","fields":{"slug":"/2018-10-nodejsapi/"},"headings":[{"value":"安裝 Node.js express","id":"安裝-nodejs-express","depth":2},{"value":"建立 nodejs server","id":"建立-nodejs-server","depth":2},{"value":"/index.js","id":"indexjs","depth":4},{"value":"index.html","id":"indexhtml","depth":4},{"value":"建立 mLab account 創建 mongoDB","id":"建立-mlab-account-創建-mongodb","depth":2},{"value":"POST Api 創建資料","id":"post-api-創建資料","depth":2},{"value":"index.js","id":"indexjs-1","depth":4},{"value":"javascript fetch post","id":"javascript-fetch-post","depth":4},{"value":"Get Api 取得資料","id":"get-api-取得資料","depth":2},{"value":"index.js","id":"indexjs-2","depth":4},{"value":"Delete Api 取得資料","id":"delete-api-取得資料","depth":2},{"value":"Update Api 更新資料","id":"update-api-更新資料","depth":2},{"value":"localhost api file","id":"localhost-api-file","depth":4},{"value":"部署到 Heroku","id":"部署到-heroku","depth":2},{"value":"heroku deploy 流程","id":"heroku-deploy-流程","depth":3},{"value":"實作頁面","id":"實作頁面","depth":3},{"value":"完整程式碼","id":"完整程式碼","depth":3}],"excerpt":"前端不斷的演進，更講求畫面快速變化，跳脫傳統傳送資料方式，漸漸改為用 javascript 連接，所以，server 端就負責建立 api，透過串接 api 處理資料。 關於 \b\bApi，\b 就有所謂的 RESTful (Representational State Transfer)，RESTful…","html":"<p>前端不斷的演進，更講求畫面快速變化，跳脫傳統傳送資料方式，漸漸改為用 javascript 連接，所以，server 端就負責建立 api，透過串接 api 處理資料。</p>\n<p>關於 \b\bApi，\b 就有所謂的 RESTful (Representational State Transfer)，RESTful 是某種設計架構的稱呼，方便、有彈性的傳輸資料。後面來會用 node.js 搭配 express 架構 RESTful Api，部署到 server 上，建立一個簡單的留言板。</p>\n<p><a href=\"https://work.ianccy.com/commentboard/\" title=\"Demo comment board\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Demo comment board</a><br>\nFree Heroku 會 sleep，太慢請 reload</p>\n<!--- ![node restful api](../images/nodeapi.png \"node restful api\") --->\n<h2 id=\"安裝-nodejs-express\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%9D-nodejs-express\" aria-label=\"安裝 nodejs express permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安裝 Node.js express</h2>\n<p>首先先創建資料夾，npm init 安裝 package.json。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create file</span>\nmkdir nodeapi\ncd nodeapi\n<span class=\"token comment\">// install package.json</span>\nnpm init\n<span class=\"token comment\">// install express</span>\nnpm install <span class=\"token operator\">--</span>save express</code></pre></div>\n<p>接下來要開始建立 node.js\b server</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// open package.json &amp; add npm start</span>\n<span class=\"token operator\">...</span>\n\b  <span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">// create index.js</span>\ntouch index<span class=\"token punctuation\">.</span>js</code></pre></div>\n<h2 id=\"建立-nodejs-server\" style=\"position:relative;\"><a href=\"#%E5%BB%BA%E7%AB%8B-nodejs-server\" aria-label=\"建立 nodejs server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>建立 nodejs server</h2>\n<p>\b\b 以 index.js 作為 node.js server 的起始點，首先引入 express，執行使用 express，這邊先設定好 Port 是 3000，再來建立 get 的 route，路徑是/comments。儲存後執行 npm start，在網址輸入 <a href=\"http://localhost:3000/%EF%BC%8C%E9%80%99%E6%99%82%E5%80%99%E6%9C%83%E7%9C%8B%E5%88%B0%E7%95%AB%E9%9D%A2%E9%A1%AF%E7%A4%BA\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/，這時候會看到畫面顯示</a> Hello world。</p>\n<h4 id=\"indexjs\" style=\"position:relative;\"><a href=\"#indexjs\" aria-label=\"indexjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>/index.js</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">server start on http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, port</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"indexhtml\" style=\"position:relative;\"><a href=\"#indexhtml\" aria-label=\"indexhtml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.html</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"viewport\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"width=device-width, initial-scale=1.0\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>meta http<span class=\"token operator\">-</span>equiv<span class=\"token operator\">=</span><span class=\"token string\">\"X-UA-Compatible\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"ie=edge\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>Document<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Hello<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span></code></pre></div>\n<h2 id=\"建立-mlab-account-創建-mongodb\" style=\"position:relative;\"><a href=\"#%E5%BB%BA%E7%AB%8B-mlab-account-%E5%89%B5%E5%BB%BA-mongodb\" aria-label=\"建立 mlab account 創建 mongodb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>建立 mLab account 創建 mongoDB</h2>\n<p>因為我想試試看串接 mongoDB，這邊選用 mLab 來管理 mongoDB，流程大概是進入 mlab 網站，建立帳戶，再來創建 db，點擊建立 User，設定帳號、密碼、權限。</p>\n<p>這邊雖然看似簡單但非常麻煩。</p>\n<p><a href=\"https://docs.mlab.com/\" title=\"mlab 建立mongoDB教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mlab 建立 mongoDB 教學</a></p>\n<p>記得要 create user，後面會依靠這個 username 跟 password 來串接 mongoDB，我因為打錯 dbName，顯示 <em>MongoError: not authorized on dbname to execute command</em>，大概卡了 40 分鐘…。</p>\n<p>\n  <figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc6984bbbe0afed7127ad9781e84c904/acfc1/createmlab.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.23232323232323%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABW0lEQVQoz32RTW6DMBCFuUUDGDBgm2BjwNgBggn5a5ru2xtUWfQWWfTgHZJ2E6mVPj29xTyNn8fhjc2qHpHSSwo/lf8DM4wr3U2VGRGRDhWKiCZeliEt/IT7SQ6glAN3/0CQ5pgVEZs3zWFaqEw2ABgqalLoVKiICS/OHnAxu0FdnM3hgPAgFaCwOWQSQBReKBZR9hSxRcR+FQIspAKl+RwhAio4TW/rdqg7W+m2UrpURmmtu16vreqs6kcAZpp+KMxGtlPRTmU7ydUmoJXTTc/D/rUdtvX7Z3n5Mper/Lia81s/7ob9y2o8mPGw3p3s4aztATD2aMZj1W1DVjvSbLiymNWuGHx9QvrkqqPHGi8W8w/DCW5XQGnpp2CKrGr1eivUGkFnkpcYmiRLL0g8FHkIR5iimHkYoDe9mx8fkmVMOSbQXDpcj3ljubbCbO7Idiv0+Bd8xkIkouU3AsJbjB2RZNMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/cc6984bbbe0afed7127ad9781e84c904/a805d/createmlab.webp 495w,\n/static/cc6984bbbe0afed7127ad9781e84c904/6ec60/createmlab.webp 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/cc6984bbbe0afed7127ad9781e84c904/b3db0/createmlab.png 495w,\n/static/cc6984bbbe0afed7127ad9781e84c904/acfc1/createmlab.png 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/cc6984bbbe0afed7127ad9781e84c904/acfc1/createmlab.png\"\n          alt=\"createmlab\"\n          title=\"createmlab\"\n          src=\"/static/cc6984bbbe0afed7127ad9781e84c904/acfc1/createmlab.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">createmlab</figcaption>\n  </figure>\n      </p>\n<p>首先安裝 mongodb。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">npm install <span class=\"token operator\">--</span>save mongodb</code></pre></div>\n<p>index.js 增加內容</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// modify index.js</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> MongoClient <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>MongoClient<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'mongodb://ian:PASSWORD@ds131323.mlab.com:31323/ian-test'</span><span class=\"token punctuation\">;</span>\n\nMongoClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> db</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> dbo <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ian-test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> myobj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"john\"</span><span class=\"token punctuation\">,</span> time<span class=\"token operator\">:</span> <span class=\"token string\">\"2018/10/13/00:58\"</span><span class=\"token punctuation\">,</span> content<span class=\"token operator\">:</span> <span class=\"token string\">\"hello, good evening\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    dbo<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"comments\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">insertOne</span><span class=\"token punctuation\">(</span>myobj<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1 document inserted\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      db<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>修改完成後輸入 npm start，如果沒出現 error 就可以打開 collection 觀看，會增加一個 comments 的 collection，點開 comments 會發現剛剛 myobj 資料在裡面。這邊是建立資料邏輯，在 RESTful 會用到 Create，剩下更新 PUT、刪除 Delete、讀取 Get 後面再寫上。</p>\n<p><a href=\"https://www.w3schools.com/nodejs/nodejs_mongodb_createcollection.asp\" title=\"w3c mongoDB 語法教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">w3c mongoDB 語法教學</a></p>\n<p>\n  <figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/41c605de528aa5a44ed3fd17fb825d49/1ec2b/mlabData.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 781px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.98989898989899%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABLklEQVQY02OQVtbVMbYxsHA0MHdQ0jKWUNCSUtIGImklHaAUfsQAxCo6pur6lkAjjCwc1fQs5HWtFPSsZNQMpRSBpuhgRUBdUuqmIM1qeuYKGkZ+oTE9E6aq6JrJaRjLa5rIaxjKqxtgRUAHKmoay6gZMACNcfAKCohMDI5OjknJ8g6O9g6O8g2J8QyK9giMQkNAQWefsOLKen1zBwl5LZDNQM2RSZmBkQm+QZEhUQkhkQmhkYk+YbHuIdEeqMgrNMbRL7S5s8/Y1l1aQQtks52bv39kQmx6XlF1o294vGdwlKNPiJNviLNvKBpy8Quz8wjILanSM7MHBi3IZmVtEzk1AzefkIqaRgV1QxkVPVlVfVlVPTwIqAyoBqRZEhyqonIaAhLKuIIXS4Ar6QAAsi1nYtrr3J8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/41c605de528aa5a44ed3fd17fb825d49/a805d/mlabData.webp 495w,\n/static/41c605de528aa5a44ed3fd17fb825d49/5f05f/mlabData.webp 781w\"\n          sizes=\"(max-width: 781px) 100vw, 781px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/41c605de528aa5a44ed3fd17fb825d49/b3db0/mlabData.png 495w,\n/static/41c605de528aa5a44ed3fd17fb825d49/1ec2b/mlabData.png 781w\"\n          sizes=\"(max-width: 781px) 100vw, 781px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/41c605de528aa5a44ed3fd17fb825d49/1ec2b/mlabData.png\"\n          alt=\"mlabData\"\n          title=\"mlabData\"\n          src=\"/static/41c605de528aa5a44ed3fd17fb825d49/1ec2b/mlabData.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">mlabData</figcaption>\n  </figure>\n      </p>\n<h2 id=\"post-api-創建資料\" style=\"position:relative;\"><a href=\"#post-api-%E5%89%B5%E5%BB%BA%E8%B3%87%E6%96%99\" aria-label=\"post api 創建資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>POST Api 創建資料</h2>\n<p>這邊要下載 body-parser 插件，要對資料格式處理，這邊要使用到是 JSON data。在 index.js 引入 body-parser，使用 bodyParser 對資料轉型別成 json type，建立 post 的 route，我們命名路徑為/comments。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">npm install body<span class=\"token operator\">-</span>parser <span class=\"token operator\">--</span>save</code></pre></div>\n<h4 id=\"indexjs-1\" style=\"position:relative;\"><a href=\"#indexjs-1\" aria-label=\"indexjs 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.js</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> bodyParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>bodyParser<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/comments'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// your JSON</span>\n    db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'comments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'saved to database'</span><span class=\"token punctuation\">)</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// modify app.listen(3000, () => {});</span>\nMongoClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> client</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ian-test'</span><span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listening on 3000'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>修改完成後重新 npm start，打開 localhost:3000，打開瀏覽器 devtool，在 console.log 貼上這段 fetch post，成功的話會接收到回傳資料，哇嗚，這樣就完成了儲存的 API!!</p>\n<h4 id=\"javascript-fetch-post\" style=\"position:relative;\"><a href=\"#javascript-fetch-post\" aria-label=\"javascript fetch post permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>javascript fetch post</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000/comments'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token operator\">:</span> <span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        Accept<span class=\"token operator\">:</span> <span class=\"token string\">'application/json, text/plain, */*'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">'mikessss'</span><span class=\"token punctuation\">,</span>\n        time<span class=\"token operator\">:</span> <span class=\"token string\">'2018/10/13-02:33:01'</span><span class=\"token punctuation\">,</span>\n        content<span class=\"token operator\">:</span> <span class=\"token string\">'ggggggg.'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"get-api-取得資料\" style=\"position:relative;\"><a href=\"#get-api-%E5%8F%96%E5%BE%97%E8%B3%87%E6%96%99\" aria-label=\"get api 取得資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get Api 取得資料</h2>\n<p>我們前面成功的建立了儲存的 api，之後的邏輯都大同小異，接收 request，再依照請求方式跟 mongoDB 連接資料。我們這邊的 get api 會拿整個 comments 的資料，如果看不懂 collection.find()，可以看一下 w3c 的 mongoDB 語法教學，非常簡單易懂。</p>\n<p>增加完成後，一樣重新啟動，再來載入 <a href=\"http://localhost:3000/comments%EF%BC%8C%E5%B0%B1%E7%9C%8B%E5%88%B0%E6%88%91%E5%80%91%E5%89%9B%E5%89%9B%E5%84%B2%E5%AD%98%E9%80%B2%E5%8E%BB%E7%9A%84%E6%89%80%E6%9C%89%E8%B3%87%E6%96%99%E4%BA%86%E3%80%82%1C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/comments，就看到我們剛剛儲存進去的所有資料了。\u001c</a></p>\n<h4 id=\"indexjs-2\" style=\"position:relative;\"><a href=\"#indexjs-2\" aria-label=\"indexjs 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.js</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/comments'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'comments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>data<span class=\"token operator\">:</span> result<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">...</span></code></pre></div>\n<h2 id=\"delete-api-取得資料\" style=\"position:relative;\"><a href=\"#delete-api-%E5%8F%96%E5%BE%97%E8%B3%87%E6%96%99\" aria-label=\"delete api 取得資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Delete Api 取得資料</h2>\n<p>這邊就建立一個 delete 的網址路徑，我們利用網址:id 來帶參數，方便我們好維運 api。mongoDB 刪除用的是 remove function，假設要用 mongoDB 預設的_id 當作查詢刪除，會多需要使用 ObjectID 處理 value，但如果你是自己用其他物件來查詢，就不用使用 ObjectID\b。</p>\n<p>這邊就不提供 fetch 測試了，推薦使用 postman 測試請求方式，又簡單又快又方便。</p>\n<p><a href=\"https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop\" title=\"postman chrome tool\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">postman chrome tool</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ObjectID <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ObjectID<span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/comments/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// use _id need use ObjectID(value)</span>\n    <span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> _id<span class=\"token operator\">:</span> <span class=\"token function\">ObjectID</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'comments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1 document deleted'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'delete success'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"update-api-更新資料\" style=\"position:relative;\"><a href=\"#update-api-%E6%9B%B4%E6%96%B0%E8%B3%87%E6%96%99\" aria-label=\"update api 更新資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Api 更新資料</h2>\n<p>建立 put 的 route，使用 updateOne 來更新資料，前面兩個參數要帶查詢、更新資料。</p>\n<p>這樣就完成了 CRUD 的 API 了，下個步驟會建立簡單的畫面，在部署到 server 上，讓我們可以在畫面操作讀取、建立、更新、刪除資料。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascripts\"><pre class=\"language-javascripts\"><code class=\"language-javascripts\">app.put(&#39;/comments/:id&#39;, (req, res) =&gt; {\n    console.log(req.params.id, req.body);\n    const newvalues = {$set: req.body};\n    const obj = {_id: ObjectID(req.params.id)};\n    db.collection(&quot;comments&quot;).updateOne(obj, newvalues, function(err, obj) {\n        if (err) throw err;\n        console.log(&quot;1 document update&quot;);\n        res.send(&#39;update success&#39;);\n    });\n})</code></pre></div>\n<h4 id=\"localhost-api-file\" style=\"position:relative;\"><a href=\"#localhost-api-file\" aria-label=\"localhost api file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>localhost api file</h4>\n<p><a href=\"https://github.com/Ianpig/node_api_comments/tree/831ddadd7cbde2f39f34adca1625e50e97a2e1c9\" title=\"github 程式碼\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">github 程式碼</a></p>\n<h2 id=\"部署到-heroku\" style=\"position:relative;\"><a href=\"#%E9%83%A8%E7%BD%B2%E5%88%B0-heroku\" aria-label=\"部署到 heroku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>部署到 Heroku</h2>\n<p>部署到 server 上，讓我們未來方便直接串接 api，提醒一下要到 heroku 設定 mLab 的連線，否則會連不到 mongoDB。<br>\n(這邊我也卡了 30 分鐘…，安裝 addons 也沒用，是執行下面的 command 才 run 起來)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">heroku config<span class=\"token operator\">:</span>set <span class=\"token constant\">PROD_MONGODB</span><span class=\"token operator\">=</span>mongodb<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>dbname<span class=\"token operator\">:</span>password@ds131323<span class=\"token punctuation\">.</span>mlab<span class=\"token punctuation\">.</span>com<span class=\"token operator\">:</span><span class=\"token number\">31323</span><span class=\"token operator\">/</span>ian<span class=\"token operator\">-</span>test</code></pre></div>\n<p><a href=\"https://devcenter.heroku.com/articles/mongolab#connecting-to-existing-mlab-deployments-from-heroku\" title=\"heroku mLab setting\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">heroku mLab setting</a></p>\n<h3 id=\"heroku-deploy-流程\" style=\"position:relative;\"><a href=\"#heroku-deploy-%E6%B5%81%E7%A8%8B\" aria-label=\"heroku deploy 流程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>heroku deploy 流程</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//login account</span>\nheroku login\n\n<span class=\"token comment\">//use git</span>\ngit init\ngit add <span class=\"token punctuation\">.</span>\ngit commit <span class=\"token operator\">-</span>m <span class=\"token string\">\"init node\"</span>\n\n<span class=\"token comment\">// create heroku repo</span>\nheroku create\n\n<span class=\"token comment\">// push remote</span>\ngit push heroku master\n\nheroku ps<span class=\"token operator\">:</span>scale web<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\nheroku open</code></pre></div>\n<p>再來載入 /comments 路徑，<a href=\"https://thawing-stream-74537.herokuapp.com/comments\" title=\"pathname/comments\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">pathname/comments</a>，看到 mongoDB 的資料拉!</p>\n<p>\n  <figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c57d5df924c812f0887b24e2d80bc47/1ec2b/apidata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 781px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.4040404040404%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABGElEQVQoz42S2W6DMBRE8/+f1jRLE0hYDd7ABkOobRazpHWV98bWlV+ujmY0d3ZSaVq2Uq9Kr1Kt32qx85CzHtafd283jAsk0vPxFeBLjgLEAlSGqGJisOvn/7CZn1yYj8/g5CceRDdEvRwmpK7b6b2ymTdUqLIaKe8J15gp++dlV7ejE8yE2R/CQxAdQWyV74ha57zpnWDKeu+Oo4RlZZNSEREOaCsexhVOMxGTyockwhwUTYg5E9olsO0V2PmeHrPYy7GFYSHbbnZSxoVKsjrJa2s4xAwxmRdd1Q5ugdXj+QKuKbSnsuYjwmJcVY3DnSezUT5+XaEfkBMA+zi+QYoL3TwcbE9m6aRR/ab6v4a+xjZU9+/r+QtzIrCfLomdmAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/5c57d5df924c812f0887b24e2d80bc47/a805d/apidata.webp 495w,\n/static/5c57d5df924c812f0887b24e2d80bc47/5f05f/apidata.webp 781w\"\n          sizes=\"(max-width: 781px) 100vw, 781px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5c57d5df924c812f0887b24e2d80bc47/b3db0/apidata.png 495w,\n/static/5c57d5df924c812f0887b24e2d80bc47/1ec2b/apidata.png 781w\"\n          sizes=\"(max-width: 781px) 100vw, 781px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/5c57d5df924c812f0887b24e2d80bc47/1ec2b/apidata.png\"\n          alt=\"node api data\"\n          title=\"node api data \"\n          src=\"/static/5c57d5df924c812f0887b24e2d80bc47/1ec2b/apidata.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">node api data </figcaption>\n  </figure>\n      </p>\n<p>大功告成，接下來就處理好前端串接，畫面互動就可以了。</p>\n<h3 id=\"實作頁面\" style=\"position:relative;\"><a href=\"#%E5%AF%A6%E4%BD%9C%E9%A0%81%E9%9D%A2\" aria-label=\"實作頁面 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>實作頁面</h3>\n<p><a href=\"https://work.ianccy.com/commentboard/\" title=\"Demo comment board\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Demo comment board</a></p>\n<h3 id=\"完整程式碼\" style=\"position:relative;\"><a href=\"#%E5%AE%8C%E6%95%B4%E7%A8%8B%E5%BC%8F%E7%A2%BC\" aria-label=\"完整程式碼 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>完整程式碼</h3>\n<p><a href=\"https://github.com/Ianpig/node_api_comments\" title=\"github 程式碼\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">github 程式碼</a></p>\n<p>有問題歡迎詢問，感謝閱讀！！</p>","frontmatter":{"title":"Node.js Express MongoDB RESTful Api 留言板實作教學","date":"October 11, 2018","description":"RESTful是某種設計架構的稱呼，方便、有彈性的傳輸資料。這邊會用node.js搭配express架構RESTful Api，資料會使用mongoDB，部署到server上，建立一個簡單的留言板。","categories":"javascript","tags":["node.js"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACCUlEQVQoz2P49x8nwCMFAQx/san7++/ftju3HZavbL1y6y9Y9i+yof+ACEQwlN16B1aNYtunHz8qt25JmjW97cTJB99+/vj7791vqPYfP/79/AmzuWbZg9Nvvk9/8hliJNDOv3//gsxFseofRBzIvnz+xd6VDw8sOjstaRnDIu2Vvj4zAxr2Ljr9Gk3PH7CePzCz/vz5AySPnjwc7GefEmqdGeXKMIEhr1qyuF2vf0H1nhs3r2/ZvGXXrl3Hjh27ePHitm3b1q1bt2XLloMHDly4cGHjhnWHjp68cmjN5Hi285tTX705y7CE1b6a3yOBwWGSd9W379+uXb164/qNq1eu3L9///nz57du3nz2FASeP3/2+NHDN59/fD63+ev8zP+/voH8vJZLspJfPZRBcZlPPsR7uKMOJPXzxc3f9078A/H+MuyXEm2S4/Nm4F9gn/zm9t0P1268u3bt9+1rb25ef3Xj+scb137dvv7n3rX/v77/+/Xj/9+/yNHKcE2W92RP4SxZv5kMxnk8Ek2cPEe5uR7LcC3g457Bw7OAi/umOOPfBJN/H16DI+MvSiL5VpP4/9/XXwdureLQXszAMY2B6Tk7wwMBhnMSDPu5GA6JM7434P/X0/YP5mwUzf///gYnl/9vmxa8kXK8xSf9SIrrljbD93Spf5k6fxJs/29Y9u/R4//YNAMAIB4+uuVFf2QAAAAASUVORK5CYII=","aspectRatio":1.6666666666666667,"src":"/static/1ed623532b4aa4e991197f6c20908da7/ee604/nodeapi.png","srcSet":"/static/1ed623532b4aa4e991197f6c20908da7/c972b/nodeapi.png 340w,\n/static/1ed623532b4aa4e991197f6c20908da7/27625/nodeapi.png 680w,\n/static/1ed623532b4aa4e991197f6c20908da7/ee604/nodeapi.png 800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"timeToRead":8,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.140Z"}}},"pageContext":{"slug":"/2018-10-nodejsapi/","previous":{"fields":{"slug":"/2018-09-firstinterviewer/"},"frontmatter":{"title":"第一次面試人","tags":["frontend"]}},"next":{"fields":{"slug":"/2018-10-tagteach/"},"frontmatter":{"title":"Google Tag Manager(gtm)教學 觸發、代碼、變數設定介紹","tags":["tag_manager","google_analytics"]}}}},"staticQueryHashes":["1481458783","63159454"]}