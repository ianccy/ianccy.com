{"componentChunkName":"component---src-templates-blog-post-js","path":"/eventpass/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"2064f693-4528-566d-863d-1226e5da3ff0","fields":{"slug":"/2019-03-eventpass/"},"headings":[{"value":"DOM 一般事件綁定","id":"dom-一般事件綁定","depth":2},{"value":"事件傳遞 Capture Bubble","id":"事件傳遞-capture-bubble","depth":2},{"value":"Capture Bubble 實用範例","id":"capture-bubble-實用範例","depth":2},{"value":"心得","id":"心得","depth":2}],"excerpt":"JavaScript 處理 DOM 事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如: popup 視窗的關閉、內外層 DOM 互動關係，另外事件獲取、冒泡也幾乎是面試必考題。 DOM 一般事件綁定 下面的例子，我 container 先綁定 click 事件，再綁定 first…","html":"<p>JavaScript 處理 DOM 事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如: popup 視窗的關閉、內外層 DOM 互動關係，另外事件獲取、冒泡也幾乎是面試必考題。</p>\n<!--- ![JavaScript logo](../images/JavaScript-logo.png \"JavaScript logo\")\n--->\n<h2 id=\"dom-一般事件綁定\" style=\"position:relative;\"><a href=\"#dom-%E4%B8%80%E8%88%AC%E4%BA%8B%E4%BB%B6%E7%B6%81%E5%AE%9A\" aria-label=\"dom 一般事件綁定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DOM 一般事件綁定</h2>\n<p>下面的例子，我 container 先綁定 click 事件，再綁定 first，各自彈出自己的 id 名稱，那哪個會先 alert 出來。</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">&lt;div id=&quot;container&quot;&gt;container\n  &lt;ul id=&quot;list&quot;&gt;ist\n    &lt;li id=&quot;first&quot;&gt;number 1&lt;/li&gt;\n  &lt;/ul&gt;\n&lt;/div&gt;\n...\n&lt;script&gt;\ndocument.getElementById(&#39;container&#39;).addEventListener(&#39;click&#39;,function(e){\n  alert(this.id);\n});\ndocument.getElementById(&#39;first&#39;).addEventListener(&#39;click&#39;,function(e){\n  alert(this.id);\n});\n&lt;/script&gt;</code>\n        </deckgo-highlight-code>\n<p>會是 first 先彈跳出來，因為綁定事件順序並不是代表執行順序，單純只是哪個 DOM 先綁定事件監聽，實際執行序還是要依照 DOM 父子關係判定，除非是綁定到同個 DOM 上，才會依照先後綁定順序執行。</p>\n<iframe src=\"//codepen.io/chu1228/embed/rRqGga/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"290\"></iframe>\n<h2 id=\"事件傳遞-capture-bubble\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E4%BB%B6%E5%82%B3%E9%81%9E-capture-bubble\" aria-label=\"事件傳遞 capture bubble permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事件傳遞 Capture Bubble</h2>\n<p>我們可以在 addEventListener(‘click’,function(){}, <code class=\"language-text\">true</code>)，來決定 useCapture 參數的 boolean，預設沒帶會是設為 false，當 usecaptue 為 true 時，事件觸發會先經由 DOM tree 一路往子層到目標為止，之後再冒泡上去父層，這樣一個完整的流程就是事件獲取與冒泡。</p>\n<p>最重要就是我們有辦法阻止事件獲取冒泡的傳遞，利用 event.stopPropagation function，就可以阻止事件往後傳遞。</p>\n<p>另外 event 還有提供物件 eventPhase，會回傳 0~4 的數值，讓我們可以清楚知道這個事件到什麼階段。</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">eventPhase: 0 沒有事件\neventPhase: 1 獲取階段，會以物件父層一直到最高開始執行，最頂端會是Window，\n              再來Document，Html，一直到目標為止。\neventPhase: 2 目標階段，這代表事件執行到目標\neventPhase: 3 冒泡階段，會由目標物件的第一層父層開始，一路往上到最頂端window為止。</code>\n        </deckgo-highlight-code>\n<p><a href=\"https://developer.mozilla.org/zh-TW/docs/Web/API/EventTarget/addEventListener#%E5%8F%83%E6%95%B8\" title=\"EventListener usecapture MDN\">EventListener usecapture MDN</a></p>\n<p>\n  <figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2cd7d323a2c45583b490d8632d71165c/acfc1/dompass.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 57.17171717171718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz3WSC2/CIBCA/f9/a1OTZXFmupnpdJkWR2uhLa0tr+MGfUyjGb3cAb2Pu+MYOecAgvImWGuBEKDUEdLL4eAoDb9ar9YfOj1CRD8LKlg/QQtWlIJnTMoGnIUeCce3Hu5Pj7xBdyFrU2tr0rwmSV416j19U1aHAL0M5A3sD/ZOi9Prmm/iDD8OQmncFdtlNMf4rI7MMNHD/0XWYMbHiQZNc7qNP4US0/2Y5yeU1kp1C3c1dwtbS5TuK9nN6Uslqw1dpyLhDZ+QKQ45433N3Zb54SpKMTnPyPO+IiiFJDMs9stksWIrz8MffZN2+wVpnexD9MhKAmWsCtLoMsq+UTvbqNDYIfnryBh61w7P5zIjZQxKnE9PppgDZ/qYacJA6SF1Dw9Nd1fN7HhrjSjyImdGN32EFrt/JJfRLftLvWx27wiH+oLDL99ef+eDNDHnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/2cd7d323a2c45583b490d8632d71165c/a805d/dompass.webp 495w,\n/static/2cd7d323a2c45583b490d8632d71165c/6ec60/dompass.webp 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/2cd7d323a2c45583b490d8632d71165c/b3db0/dompass.png 495w,\n/static/2cd7d323a2c45583b490d8632d71165c/acfc1/dompass.png 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/2cd7d323a2c45583b490d8632d71165c/acfc1/dompass.png\"\n          alt=\"JavaScript dompass\"\n          title=\"JavaScript dompass\"\n          src=\"/static/2cd7d323a2c45583b490d8632d71165c/acfc1/dompass.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">JavaScript dompass</figcaption>\n  </figure>\n      </p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">// get All elements\nconst nodeList= [...document.querySelectorAll(&#39;*&#39;)];\n\n// add All elements eventListener\nnodeList.forEach(elem =&gt;{\n    // use true is for capture\n    elem.addEventListener(&quot;click&quot;, e =&gt;\n      alert(`capture ${elem.tagName} phase:${e.eventPhase}`)\n    , true );\n    // default false is for bubble\n    elem.addEventListener(&quot;click&quot;, e =&gt;\n      alert(`bubble: ${elem.tagName} phase:${e.eventPhase}`)\n    );\n});</code>\n        </deckgo-highlight-code>\n<iframe src=\"//codepen.io/chu1228/embed/EMdwVJ/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"290\"></iframe>\n<p><a href=\"https://codepen.io/chu1228/pen/EMdwVJ\" title=\"獲取&#x26;冒泡\">簡易獲取&#x26;冒泡</a></p>\n<p><a href=\"https://codepen.io/pen/?&#x26;editable=true\" title=\"MDN eventphase flow\">MDN eventphase flow</a> (MDN 教學)</p>\n<h2 id=\"capture-bubble-實用範例\" style=\"position:relative;\"><a href=\"#capture-bubble-%E5%AF%A6%E7%94%A8%E7%AF%84%E4%BE%8B\" aria-label=\"capture bubble 實用範例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Capture Bubble 實用範例</h2>\n<p>這邊我們用最經典的 popup 例子，需求是要點擊按鈕 click 會讓 popup 顯示的，但在這邊我們希望 popup 內部點擊不會關閉 popup，但是點外部隨便空間會關閉 popup。</p>\n<p>首先監聽 body 點擊會關閉 popup，再來監聽 openPop 按鈕點擊讓 popup 打開，這邊還多下了 <code class=\"language-text\">e.stopPropagation()</code>;，防止我點擊 popup 打開觸發 body 點擊被關閉，因為這樣可以中斷點擊 popup 往上冒泡觸發 body 事件。</p>\n<p>再來是 popup 本身需要能點選內部內容，同樣我們也對 popup 使用 e.stopPropagation(); ，讓我們可以點擊 popup 裡面的內容、按鈕。</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">&lt;button id=&quot;openPop&quot;&gt;open popup&lt;/button&gt;\n&lt;div id=&quot;text&quot;&gt;&lt;/div&gt; // fake wording\n&lt;div id=&quot;popup&quot; class=&quot;&quot;&gt;\n  &lt;span id=&quot;closePop&quot;&gt;x&lt;/span&gt;\n  &lt;div&gt;\n    This is popup\n    &lt;button onclick=&quot;alert(&#39;hello&#39;)&quot;&gt;Alert Button&lt;/button&gt;\n   &lt;/div&gt;\n&lt;/div&gt;\n...\nconst popup = document.getElementById(&#39;popup&#39;);\ndocument.getElementById(&#39;openPop&#39;).addEventListener(&#39;click&#39;,(e)=&gt;{\n    e.stopPropagation();\n    popup.classList.add(&quot;active&quot;);\n});\n\ndocument.body.addEventListener(&#39;click&#39;,()=&gt;{\n    close();\n});\n\npopup.addEventListener(&#39;click&#39;,(e)=&gt;{\n    e.stopPropagation();\n});\n\ndocument.getElementById(&#39;closePop&#39;).addEventListener(&#39;click&#39;,()=&gt;{\n    close();\n});\n\nfunction close () {\n    popup.classList.remove(&#39;active&#39;);\n}</code>\n        </deckgo-highlight-code>\n<iframe src=\"//codepen.io/chu1228/embed/MxzoZK/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"390\"></iframe>\n<h2 id=\"心得\" style=\"position:relative;\"><a href=\"#%E5%BF%83%E5%BE%97\" aria-label=\"心得 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>心得</h2>\n<p>這觀念真心覺得實用，很多疑難雜症可以處理，或是可以少綁一些 eventlistener，利用父層子層獲取冒泡關係，搭配 stopPropagation。</p>","frontmatter":{"title":"JavaScript Capture Bubble DOM事件獲取&冒泡","date":"March 21, 2019","description":"JavaScript處理DOM事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如popup視窗的關閉、內外層DOM互動關係，另外事件獲取、冒泡也幾乎是面試必考題。","categories":"javascript","tags":["javascript"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz3WSC2/CIBCA/f9/a1OTZXFmupnpdJkWR2uhLa0tr+MGfUyjGb3cAb2Pu+MYOecAgvImWGuBEKDUEdLL4eAoDb9ar9YfOj1CRD8LKlg/QQtWlIJnTMoGnIUeCce3Hu5Pj7xBdyFrU2tr0rwmSV416j19U1aHAL0M5A3sD/ZOi9Prmm/iDD8OQmncFdtlNMf4rI7MMNHD/0XWYMbHiQZNc7qNP4US0/2Y5yeU1kp1C3c1dwtbS5TuK9nN6Uslqw1dpyLhDZ+QKQ45433N3Zb54SpKMTnPyPO+IiiFJDMs9stksWIrz8MffZN2+wVpnexD9MhKAmWsCtLoMsq+UTvbqNDYIfnryBh61w7P5zIjZQxKnE9PppgDZ/qYacJA6SF1Dw9Nd1fN7HhrjSjyImdGN32EFrt/JJfRLftLvWx27wiH+oLDL99ef+eDNDHnAAAAAElFTkSuQmCC","aspectRatio":1.7435897435897436,"src":"/static/2cd7d323a2c45583b490d8632d71165c/ee604/dompass.png","srcSet":"/static/2cd7d323a2c45583b490d8632d71165c/c972b/dompass.png 340w,\n/static/2cd7d323a2c45583b490d8632d71165c/27625/dompass.png 680w,\n/static/2cd7d323a2c45583b490d8632d71165c/ee604/dompass.png 800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"timeToRead":4,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:09:39.796Z"}}},"pageContext":{"slug":"/2019-03-eventpass/","previous":{"fields":{"slug":"/2019-02-keywordselect/"},"frontmatter":{"title":"SEO關鍵字分析選擇，優化工具介紹","tags":["seo"]}},"next":{"fields":{"slug":"/2019-03-society/"},"frontmatter":{"title":"聊聊4年前，剛出社會的我","tags":[null]}}}},"staticQueryHashes":["1481458783","63159454"]}