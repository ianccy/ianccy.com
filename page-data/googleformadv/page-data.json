{"componentChunkName":"component---src-templates-post-tsx","path":"/googleformadv/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu"}},"markdownRemark":{"id":"b6eefcc6-e75e-53f1-8474-4d3ea6d3410b","excerpt":"嗨，接下來要來分享 google excel api 之前未完成的部分，前面介紹了建立 api，讓我們能在 google excel 新資料，但是透過 api 管理資料還差讀取、更新表單資料，簡單講就是 API 的 CRUD。 後面會完成 API…","html":"<p>嗨，接下來要來分享 google excel api 之前未完成的部分，前面介紹了建立 api，讓我們能在 google excel 新資料，但是透過 api 管理資料還差讀取、更新表單資料，簡單講就是 API 的 CRUD。</p>\n<p>後面會完成 API 串接做查詢、更新資料，還有簡單的前端操作畫面。</p>\n<p>完成畫面: <a href=\"https://work.ianccy.com/friedQuery.html\" title=\"鹹酥雞查詢訂單\">鹹酥雞查詢訂單</a></p>\n<ul>\n<li>\n<p>前文章連結 : <a href=\"https://ianccy.com/googleformapi/\" title=\"Google sheet 試算表表單串接api\">Google sheet 試算表表單串接 api </a></p>\n</li>\n<li>\n<p>Google 官方文件 <a href=\"https://developers.google.com/apps-script/reference/spreadsheet/sheet\" title=\"google sheet api\">spreadsheet method</a></p>\n</li>\n<li>\n<p><a href=\"https://work.ianccy.com/%E7%82%B8%E9%9B%9E%E8%A8%82%E8%B3%BC\" title=\"鹹酥雞訂購 範例網頁\">鹹酥雞訂購 範例網頁</a>、<a href=\"https://docs.google.com/spreadsheets/d/1JbXssixJaqTL_BMgnmOiMxLyAZm0jOkw173VdewqO9c/edit#gid=0\" title=\"鹹酥雞訂購 Excel\">鹹酥雞訂購 Excel</a></p>\n</li>\n</ul>\n<h2 id=\"查詢訂單-api\" style=\"position:relative;\"><a href=\"#%E6%9F%A5%E8%A9%A2%E8%A8%82%E5%96%AE-api\" aria-label=\"查詢訂單 api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>查詢訂單 api</h2>\n<p>鹹酥雞訂購的填表，還需要增加一個功能，就是客人需要查詢訂單的狀態，有沒有成功送出訂單，還有老闆有沒有幫我確認製作，不然跑去現場然後老闆忘記做餐…。</p>\n<p>會是用填表姓名還有電話查詢。這邊用比較特別的處理方法，我們直接拉出電話陣列，直接比對電話號碼是否存在，有存在號碼會再比對姓名是否相符。才會回拋出資料。我沒特別研究 BigQueryDataSourceSpecBuilder，貌似可以直接下 query 語法。</p>\n<p>這邊改用 doPost，首先起手一樣用 getSheets 先取得我們的 tab，使用 getSheetValues 來拿到整包資料。拿到的資料會是陣列，我們可以跑迴圈來找出每一筆的 name、phone，有沒有在陣列內，有的話才要增加到回傳的陣列。最後回傳資料會是一包陣列裡面會是{data: [ ], index: x}，index 方便我們後續做更新的操作。</p>\n<p><code class=\"language-text\">getSheetValues(startRow, startColumn, numRows, numColumns)</code></p>\n<p>ps.儲存發布記得要再新增版本，這邊我卡了 1 小時…。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>parameter<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> phone <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>phone<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> SpreadSheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">openById</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"1JbXssixJaqTL_BMgnmOiMxLyAZm0jOkw173VdewqO9c\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> Sheet <span class=\"token operator\">=</span> SpreadSheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> LastRow <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// get All data as Array</span>\n  <span class=\"token comment\">// first row, first column, last row, seven columns</span>\n  <span class=\"token keyword\">var</span> listAll <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetValues</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> LastRow<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// find phone and name mapping data and Push Array</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// return data as JSON</span>\n  <span class=\"token keyword\">return</span> ContentService<span class=\"token punctuation\">.</span><span class=\"token function\">createTextOutput</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setMimeType</span><span class=\"token punctuation\">(</span>\n    ContentService<span class=\"token punctuation\">.</span>MimeType<span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://developers.google.com/apps-script/reference/spreadsheet/sheet#getSheetValues(Integer,Integer,Integer,Integer)\" title=\"google sheet getSheetValues\">google sheet getSheetValues</a></p>\n<p>這樣就完成了查詢訂單的 api，當我們用 post 請求 api，並且帶上 name、phone 的參數，就會幫我們查詢並回傳符合比對的資料。</p>\n<p>建議安裝 postman，方便直接測試 api。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45d2f2ee9e081db00780cbd94146cf77/acfc1/postmanapipost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.04040404040405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVR42pWQzY7DMAiE/f5vWe2tslsn+AcGjFdJVtl2e9l8mgNIDB4T8pLzktMjbYr3mGI6eKSY4jM/V1pfRYV+CqIgzL03FmmtNlqYGcDYcffxjpqa2dmGnPPvyD7t7mbWWvMPAKjq2Qai1baVbwAQEftAd44CqqGsS6ml9lqIVHiMv1FfOTPLYWZm6aikR+B5hdCZW/evmxPNUgfG/L+CQLYrwOacFx+eAYBv/7zo283flkkRZO7cS4MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/45d2f2ee9e081db00780cbd94146cf77/a805d/postmanapipost.webp 495w,\n/static/45d2f2ee9e081db00780cbd94146cf77/6ec60/postmanapipost.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/45d2f2ee9e081db00780cbd94146cf77/b3db0/postmanapipost.png 495w,\n/static/45d2f2ee9e081db00780cbd94146cf77/acfc1/postmanapipost.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/45d2f2ee9e081db00780cbd94146cf77/acfc1/postmanapipost.png\"\n            alt=\"postmanapi post\"\n            title=\"postmanapi post\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">postmanapi post</figcaption>\n  </figure></p>\n<h2 id=\"更新訂單-api\" style=\"position:relative;\"><a href=\"#%E6%9B%B4%E6%96%B0%E8%A8%82%E5%96%AE-api\" aria-label=\"更新訂單 api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>更新訂單 api</h2>\n<p>客人送出訂單後，可能需要取消訂單，這時候就需要對資料更新了。我們可以搭配查詢 api，讓客人看到自己的訂單，再對訂單更新狀態。我們用前面做好的 doPost function，直接擴展增加更新的功能。</p>\n<p>增加 action，作為查詢、刪除的判斷，再稍微整理一下拆分共用的邏輯，把執行部分打包成 function。建立 updateData，專門更新訂單的狀態，我們取得 index，直接查詢這個 row 的資料，拿請求的 name、phone 直接比對是否符合，符合的話才讓使用者可以更新訂單狀態。</p>\n<p>另外我們定義處理狀態 0 代表訂單取消，1 代表完成訂單。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>parameter<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> phone <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>phone<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> status <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> index <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> action <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">var</span> SpreadSheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">openById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1JbXssixJaqTL_BMgnmOiMxLyAZm0jOkw173VdewqO9c\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> Sheet <span class=\"token operator\">=</span> SpreadSheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action <span class=\"token operator\">===</span> <span class=\"token string\">'query'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    data <span class=\"token operator\">=</span> <span class=\"token function\">queryData</span><span class=\"token punctuation\">(</span>Sheet<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action <span class=\"token operator\">===</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    data <span class=\"token operator\">=</span> <span class=\"token function\">updateData</span><span class=\"token punctuation\">(</span>Sheet<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> phone<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> ContentService<span class=\"token punctuation\">.</span><span class=\"token function\">createTextOutput</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">setMimeType</span><span class=\"token punctuation\">(</span>ContentService<span class=\"token punctuation\">.</span>MimeType<span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">queryData</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">Sheet<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> phone</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> LastRow <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">var</span> listAll <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetValues</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> LastRow<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> listAll<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> listAll<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">updateData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">Sheet<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> phone<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> checkName <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetValues</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> checkPhone <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetValues</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> phone<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>checkName <span class=\"token operator\">&amp;&amp;</span> checkPhone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">return</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"前端畫面\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E7%AB%AF%E7%95%AB%E9%9D%A2\" aria-label=\"前端畫面 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前端畫面</h2>\n<p>這樣就完成了查詢、更新訂單的 api 了，剩下就是網頁前端部分，網頁需求是讓使用者輸入姓名、電話查詢訂單，或是查詢後可以取消訂單。</p>\n<p>前端主要的 function 就這些，主要就是查詢拉資料，更新 List 清單，點擊取消訂單的按鈕，請求 API 更新狀態等等。</p>\n<p>前端畫面比起 API 來說，就比較單純這邊不多贅述了。要用 vanilla javascript、jquey、或 react、vue，看你喜歡都可以做到一樣功能。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">      <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"col-lg-12 text-center\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"mt-5\"</span><span class=\"token operator\">></span>查詢訂單<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group col-xs-12\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>label <span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"pwd\"</span><span class=\"token operator\">></span>姓名<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"text\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"name\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group col-xs-12\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>label <span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"pwd\"</span><span class=\"token operator\">></span>電話<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"number\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"phone\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group col-xs-12\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"send\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"btn btn-primary col-xs-12\"</span><span class=\"token operator\">></span>送出查詢<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group col-xs-12\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>table <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"table table-striped\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"display: none;\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>thead<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>tr<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Name<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Phone<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Time<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Item<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Price<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Status<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>th<span class=\"token operator\">></span>Update<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>th<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>tr<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>thead<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>tbody id<span class=\"token operator\">=</span><span class=\"token string\">\"dataView\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>tbody<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>table<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"col-xs-12 text-center\"</span><span class=\"token operator\">></span>純屬線上訂購 demo<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">...</span>\n  <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#send'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> status <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> phone <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#phone'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n              <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'border'</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n              <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'border'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'1px solid #ff0000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              status <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>phone <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n              <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#phone'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'border'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'1px solid #ff0000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              status <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">'name'</span> <span class=\"token operator\">:</span> name<span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'phone'</span><span class=\"token operator\">:</span>phone<span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">'action'</span><span class=\"token operator\">:</span> <span class=\"token string\">'query'</span>\n              <span class=\"token punctuation\">}</span>\n              <span class=\"token function\">sendQuery</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">handleData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> content <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">var</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> phone<span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> price<span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">var</span> index <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">var</span> statusWording <span class=\"token operator\">=</span> <span class=\"token function\">convertStatus</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          content <span class=\"token operator\">+=</span>\n              <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;tr>\n                &lt;td></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>phone<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>price<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td class=\"status\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>statusWording<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/td>\n                &lt;td>\n                  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>status <span class=\"token operator\">!==</span> <span class=\"token string\">''</span> <span class=\"token operator\">?</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">:</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;button type=\"button\" onclick=\"updateStatus('</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">', '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>phone<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">', </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>index<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, this)\" class=\"btn btn-primary\">取消訂單&lt;/button></span><span class=\"token template-punctuation string\">`</span></span>\n                  <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n                &lt;/td>\n              &lt;/tr></span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'table-striped'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'table'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'查無資料'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">var</span> dataView <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dataView'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dataView<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">convertStatus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">status</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">case</span> <span class=\"token string\">''</span><span class=\"token operator\">:</span>\n            text <span class=\"token operator\">=</span> <span class=\"token string\">'尚未處理'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n            text <span class=\"token operator\">=</span> <span class=\"token string\">'訂單已取消'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n            text <span class=\"token operator\">=</span> <span class=\"token string\">'訂單處理中'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n            text <span class=\"token operator\">=</span> <span class=\"token string\">'完成製作'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n            text <span class=\"token operator\">=</span> <span class=\"token string\">'完成交易'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> text<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">sendQuery</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://script.google.com/macros/s/AKfycbz3fU3FVDmIQehtWX6ecKuV_A67lE64FEQ-ekmOZ_jZDyY96z0/exec\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">dataType</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JSON\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">handleData</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#phone'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">updateStatus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> phone<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> that</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> name<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">phone</span><span class=\"token operator\">:</span> phone<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">action</span><span class=\"token operator\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> index<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://script.google.com/macros/s/AKfycbz3fU3FVDmIQehtWX6ecKuV_A67lE64FEQ-ekmOZ_jZDyY96z0/exec\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">dataType</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JSON\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">===</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>that<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">siblings</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.status'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token function\">convertStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>that<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'更新失敗！'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<ul>\n<li><a href=\"https://work.ianccy.com/friedQuery.html\" title=\"鹹酥雞查詢訂單 範例\">鹹酥雞查詢訂單 範例</a></li>\n</ul>\n<p>可以直接右鍵，查看原始碼，直接看我怎麼寫前端畫面的。</p>\n<h2 id=\"心得\" style=\"position:relative;\"><a href=\"#%E5%BF%83%E5%BE%97\" aria-label=\"心得 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>心得</h2>\n<p>會寫進階查詢的 API 是因為平常滿多網友有問我，所以乾脆直接寫一篇文章分享。現在工作就沒繼續接觸 sheet script API，所以前置花了點時間研究語法，我查詢資料的做法偏向暴力解，拉整包跑迴圈比對，如果有人研究出 select query 的作法，再麻煩跟我分享一下，感激不盡。</p>\n<p>對了，其實還缺老闆查詢全部資料、更新訂單狀態，這要再加上會員登入權限的 api，要擋有權限的帳號才可以查詢全部的資料，這個就讓我富奸一下下次再做吧 XD。</p>\n<p>api 那段寫得比較快，有問題再麻煩留言，感謝。</p>\n<!--- ![google sheetapiquery](../images/sheetapiquery.png \"google sheetapiquery\") --->\n","fields":{"readingTime":{"text":"9 min read"}},"frontmatter":{"title":"Google Sheet RESTful API 試算表表單","date":"May 11, 2019","description":"分享如何建立app script api管理讀取、更新excel表單資料，簡單講就是API的CRUD，並且製作一個可以用的簡單畫面，串接api更新訂單狀態。","categories":"javascript","tags":["google_form"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8e8e8","images":{"fallback":{"src":"/static/063f4f61503f698e231eb393b81038ea/d8208/sheetapiquery.png","srcSet":"/static/063f4f61503f698e231eb393b81038ea/47381/sheetapiquery.png 200w,\n/static/063f4f61503f698e231eb393b81038ea/9d80a/sheetapiquery.png 400w,\n/static/063f4f61503f698e231eb393b81038ea/d8208/sheetapiquery.png 800w","sizes":"(min-width: 800px) 800px, 100vw"},"sources":[{"srcSet":"/static/063f4f61503f698e231eb393b81038ea/988cc/sheetapiquery.webp 200w,\n/static/063f4f61503f698e231eb393b81038ea/2e226/sheetapiquery.webp 400w,\n/static/063f4f61503f698e231eb393b81038ea/831d5/sheetapiquery.webp 800w","type":"image/webp","sizes":"(min-width: 800px) 800px, 100vw"}]},"width":1280,"height":694.4}}},"image":{"publicURL":"/static/063f4f61503f698e231eb393b81038ea/sheetapiquery.png"}},"tableOfContents":"<ul>\n<li><a href=\"#%E6%9F%A5%E8%A9%A2%E8%A8%82%E5%96%AE-api\">查詢訂單 api</a></li>\n<li><a href=\"#%E6%9B%B4%E6%96%B0%E8%A8%82%E5%96%AE-api\">更新訂單 api</a></li>\n<li><a href=\"#%E5%89%8D%E7%AB%AF%E7%95%AB%E9%9D%A2\">前端畫面</a></li>\n<li><a href=\"#%E5%BF%83%E5%BE%97\">心得</a></li>\n</ul>"},"previous":{"fields":{"slug":"/2019-06-reacthooks/"},"frontmatter":{"title":"React Hooks Performance 效能處理"}},"next":{"fields":{"slug":"/2019-04-reactlazyload/"},"frontmatter":{"title":"lazy loading image 延後載入畫面外圖片"}}},"pageContext":{"id":"b6eefcc6-e75e-53f1-8474-4d3ea6d3410b","previousPostId":"bddfa0f5-e2a3-579a-8e13-d70f19fb2eef","nextPostId":"58e0bb50-1d3d-5151-a3fd-d5a84ca87c08"}},"staticQueryHashes":["3649515864","3707347541","3761976949"],"slicesMap":{}}