{"componentChunkName":"component---src-templates-post-tsx","path":"/reactssr/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu"}},"markdownRemark":{"id":"20d27da2-d557-5981-8a2d-bd1a2def444f","excerpt":"先來稍微介紹一下為什麼要做 server side render，另外這邊不會使用 next.js，雖然公司目前專案有用到，但我滿推薦用 next.js 的，很好導入並且解決很多需要處理的問題。(雖然有一些 bug、還會頻繁更新，兩年內 version 3 -> 7…) Server-side rendering…","html":"<p>先來稍微介紹一下為什麼要做 server side render，另外這邊不會使用 next.js，雖然公司目前專案有用到，但我滿推薦用 next.js 的，很好導入並且解決很多需要處理的問題。(雖然有一些 bug、還會頻繁更新，兩年內 version 3 -> 7…)</p>\n<h2 id=\"server-side-rendering-seo\" style=\"position:relative;\"><a href=\"#server-side-rendering-seo\" aria-label=\"server side rendering seo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server-side rendering SEO</h2>\n<p>傳統網站內容是依靠後端 php、jsp 等產生 html 內容，稱之為 Server-side rendering，但隨著前端技術演進，所有動態內容不再是連接資料庫取資料，轉變為使用非同步請求，依照不同需要依靠 JavaScript 直接請求 API，然後更新需要改動的 html，雖然說這樣處理很方便，使用者不用換網址發請求，整個畫面重新閃動。</p>\n<p>但這方法背後也產生 SEO 的缺點，動態內容的核心是執行 JavaScript，而網頁爬蟲卻不一定會載入執行網頁上的 JavaScript，雖然 google 官方表示爬蟲會<code class=\"language-text\">盡可能</code>的執行 script，但實務上當你要優化 SEO\u001c，就可能會避免用非同步拉資料，或是處理其他細節。這方式又稱為 Client-side rendering。</p>\n<p>PS.google 官方表示爬蟲邏輯大概是 索引 -> (有資源後) -> 執行 JavaScript，核心價值在於 URL，不同內容必須要有對應的 URL，才有可能幫你每個分頁分開索引。</p>\n<p>影片推薦觀看，能更了解 JavaScript 與爬蟲之間關係。\n<a href=\"https://www.youtube.com/watch?v=PFwUbgvpdaQ\" title=\"Google I/O &#x27;18 javascript website\">Google I/O ‘18 javascript website</a></p>\n<h2 id=\"react-server-side-render\" style=\"position:relative;\"><a href=\"#react-server-side-render\" aria-label=\"react server side render permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React server-side render</h2>\n<p>使用 React 框架，但又需要讓爬蟲能索引得到 html，就需要轉為使用 server-side render，核心概念就是，原本 JavaScript 是用戶端執行產生內容，轉向依靠 server 來產生內容，請求 API 的部分也交由 server 端處理，直接在 server 端拿到畫面相關的資料，這樣爬蟲來索引的同時，就已經拿到了內容了。</p>\n<p>接下來來試著架構出 React server-side render 的架構，會使用到 react 官方的 cli create-react-app，以及 node.js 作為 server。</p>\n<h3 id=\"使用-create-react-app-cli\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8-create-react-app-cli\" aria-label=\"使用 create react app cli permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用 create-react-app cli</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">npx create<span class=\"token operator\">-</span>react<span class=\"token operator\">-</span>app react<span class=\"token operator\">-</span>ssr\ncd react<span class=\"token operator\">-</span>ssr</code></pre></div>\n<h3 id=\"安裝使用-express\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%9D%E4%BD%BF%E7%94%A8-express\" aria-label=\"安裝使用 express permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安裝使用 express</h3>\n<p>server side render 需要後端執行 javascript，因此這邊使用 node 來處理，npm i express，再來建立 server folder，在建立一個 index.js，作為我們 server 執行的 root。</p>\n<ul>\n<li>src</li>\n<li>server\n<ul>\n<li>index.js</li>\n</ul>\n</li>\n</ul>\n<p>純粹只是 client side render，就只要執行 npm run build，再來我們針對 build 出來的資源，用 express 來控制。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// host build foler resource</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../build\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// settting router</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">\"../build/index.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 2vw 0;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef08a82f90ff47c339ab51c7d88bc89b/acfc1/csr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.83838383838384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVQoz5WSTUvDQBCG+1uUbPYzm02ySbM1SWPSJlppRQUpeOhBxYtaxIoHEcVcFMEe24sXQf+mpF78iLbC3GaemfedmZpOnYpgEhouNFyd2DqT1TXUqVUniA2gCZDATgCZ/I2vgAG2iL9qru2IjX59cEobLU2jlfx3GBquplF7c88/GGWPL8HJTXhWYCdYbDKTAJlu/6h1/5wW03z8Ghxf+4MhNLx5cEkK2mipw4v46ikfv6XFNL2bsHAdIPFTefXCeNoLhrfNy4e0mKj9c+onJTxXNiCOTuXyEhKd3fpgyNtbPNvWuQewtcDCmIRMIu6VYfoQmToSkElsuPBv2YDYjShTYXslzsM4c70wjPMo7aionWRdw1KA2PPuPOtC/YQnPZZ0oaUAtmZ2Fvww6iBLETciXhPx+oedf8DlhyIBsNC/Sv0MvwMW9Z2kiCK5LgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ef08a82f90ff47c339ab51c7d88bc89b/a805d/csr.webp 495w,\n/static/ef08a82f90ff47c339ab51c7d88bc89b/6ec60/csr.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ef08a82f90ff47c339ab51c7d88bc89b/b3db0/csr.png 495w,\n/static/ef08a82f90ff47c339ab51c7d88bc89b/acfc1/csr.png 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ef08a82f90ff47c339ab51c7d88bc89b/acfc1/csr.png\"\n            alt=\"react csr\"\n            title=\"react csr\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">react csr</figcaption>\n  </figure></p>\n<h2 id=\"express-render-react\" style=\"position:relative;\"><a href=\"#express-render-react\" aria-label=\"express render react permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>express render REACT</h2>\n<p>先談談用 node 執行 javascript 會遇到哪些難解問題。</p>\n<ul>\n<li>\n<p>首先 node 無法執行 import。\n依靠 @babel/register 搭配 @babel/plugin-syntax-dynamic-import、@babel-plugin-dynamic-import-node，讓 express 執行轉譯過的 i\nmport。</p>\n</li>\n<li>\n<p>node 無法讀取 css、image 會出現 object\n利用 style-ignore，避開執行 css 內容，並在這邊處理好 image hash name。</p>\n</li>\n<li>\n<p>render react\n透過 react-dom/server 的 renderToString 或 renderToStaticMarkup 執行 react。</p>\n</li>\n</ul>\n<p>剩下 react-router、redux、檔案加入 hash name、hot reload 等等，就先不在這邊討論。\n(置底 medium 文章有用到 redux、react-router)</p>\n<h2 id=\"建立-serverjsrenderjs\" style=\"position:relative;\"><a href=\"#%E5%BB%BA%E7%AB%8B-serverjsrenderjs\" aria-label=\"建立 serverjsrenderjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>建立 server.js、render.js</h2>\n<p>再建立 server.js loader.js 兩個檔案，<code class=\"language-text\">server.js</code> 主要負責 express，<code class=\"language-text\">index.js</code>則是處理 server 設定 babel、各種預處理修正，<code class=\"language-text\">render.js</code> 負責 render 內容。</p>\n<h2 id=\"indexjs-功能\" style=\"position:relative;\"><a href=\"#indexjs-%E5%8A%9F%E8%83%BD\" aria-label=\"indexjs 功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.js 功能</h2>\n<p>md5File 是為了讀取 image file name，搭配 ignoreStyles 使用，讓 server 讀取到 npm build 出來的 file name。這邊最黑魔法的是 babel/register，也是第一次看過這個用法，很輕鬆不需要 eject 就導入 babel 到 create react app 內。</p>\n<p><code class=\"language-text\">npm install md5-file ignore-styles</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> md5File <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"md5-file\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ignoreStyles <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ignore-styles\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> register <span class=\"token operator\">=</span> ignoreStyles<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> extensions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\".gif\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".jpeg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".png\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".svg\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ignore image and style request</span>\n<span class=\"token function\">register</span><span class=\"token punctuation\">(</span>ignoreStyles<span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT_EXTENSIONS</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">module<span class=\"token punctuation\">,</span> filename</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> filename<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// use for style</span>\n    <span class=\"token keyword\">return</span> ignoreStyles<span class=\"token punctuation\">.</span><span class=\"token function\">noOp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// use for image and add hash follow react cli</span>\n    <span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> md5File<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> bn <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(\\.\\w{3})$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>hash<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">$1</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/static/media/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bn<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@babel/polyfill\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@babel/register\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">ignore</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/(build|node_modules)\\/</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"@babel/preset-react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"@babel/plugin-syntax-dynamic-import\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"dynamic-import-node\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"react-loadable/babel\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// it will run express</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./server\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"serverjs-功能\" style=\"position:relative;\"><a href=\"#serverjs-%E5%8A%9F%E8%83%BD\" aria-label=\"serverjs 功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>server.js 功能</h2>\n<p>這邊主要就是處理 express 路由，static file 路徑，非常簡單的基本設定，比較特別的是用到 Loadable 來確保有 render component 有執行完成。</p>\n<p><code class=\"language-text\">npm install react-loadable express</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Loadable <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-loadable\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> render <span class=\"token keyword\">from</span> <span class=\"token string\">\"./render\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">4000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../build\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Loadable listener to make sure that all of your loadable components are already loaded</span>\n<span class=\"token comment\">// https://github.com/jamiebuilds/react-loadable#preloading-all-your-loadable-components-on-the-server</span>\nLoadable<span class=\"token punctuation\">.</span><span class=\"token function\">preloadAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"renderjs-功能\" style=\"position:relative;\"><a href=\"#renderjs-%E5%8A%9F%E8%83%BD\" aria-label=\"renderjs 功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>render.js 功能</h2>\n<p>這邊就是實際 render react，主要依賴 renderToString 來取得 react 執行後的 html，之後再將 react 的 html 組裝成完整頁面的資料。</p>\n<p>這邊我有傳遞資料給 App wording，假設直接看 view-source:<a href=\"http://localhost:4000/\">http://localhost:4000/</a> 會看到 THIS IS Server Side Render ，但是 client side init 會瞬間不見，這邊可以讓你做一些 call api 後的資料傳遞，但這邊要記得要設定成某個變數名，讓 client 抓取這個變數。</p>\n<p>ps.client 指的是使用者載入時。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderToString <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom/server\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Helmet <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-helmet\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src/app\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../build/index.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"utf8\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> htmlData</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error page </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">const</span> helmet <span class=\"token operator\">=</span> Helmet<span class=\"token punctuation\">.</span><span class=\"token function\">renderStatic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">injectHTML</span><span class=\"token punctuation\">(</span>htmlData<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">html</span><span class=\"token operator\">:</span> helmet<span class=\"token punctuation\">.</span>htmlAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> helmet<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">meta</span><span class=\"token operator\">:</span> helmet<span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token function\">renderToString</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App wording<span class=\"token operator\">=</span><span class=\"token string\">\"THIS IS Server Side Render\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">injectHTML</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> html<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> state <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;html>\"</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;html </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>html<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">&lt;title>.*?&lt;\\/title></span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;/head>\"</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>meta<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/head></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;div id=\"root\">&lt;/div>'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div id=\"root\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>body<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>package.json</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"@babel/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.1.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"@babel/plugin-syntax-dynamic-import\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"@babel/polyfill\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"@babel/register\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"babel-plugin-dynamic-import-node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ignore-styles\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.0.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"md5-file\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react-frontload\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.0.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react-helmet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react-loadable\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.7.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.7.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"react-scripts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.1.3\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts start\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts test\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"eject\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts eject\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=development node ./server/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=production node ./server/index.js\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><a href=\"https://github.com/Ianpig/react-sample-ssr\" title=\"Source Code Github\">Source Code Github</a></p>\n<h2 id=\"心得\" style=\"position:relative;\"><a href=\"#%E5%BF%83%E5%BE%97\" aria-label=\"心得 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>心得</h2>\n<p>整個寫完只需要三個檔案，看似簡單，但其實還有非常多部分還未處理，例如 router，要能夠在 server 處理各種路徑 render。開發時需要 hot reload，否則每次更新都要 build。這邊有看到有人有使用 nodeman 處理。各種檔案資源的壓縮優化，這就要依靠 webpack。</p>\n<p>以上問題 next.js 都有提供方法處理，官方還有各種工具整合的 sample code，雖然我自己不太愛 next.js，但它真的解決不少問題。(但是 safari back 存在各種 bug…)</p>\n<p>如果有錯誤的地方，還麻煩提出，感謝閱讀。</p>\n<ul>\n<li><a href=\"https://medium.com/@cereallarceny/server-side-rendering-in-create-react-app-with-all-the-goodies-without-ejecting-4c889d7db25e\" title=\"參考資料 medium cereallarceny\">參考資料 medium cereallarceny</a></li>\n</ul>\n<!--- ![react lifecycle](../images/react.png \"react lifecycle\") --->\n","fields":{"readingTime":{"text":"8 min read"}},"frontmatter":{"title":"React Server-side rendering SEO處理","date":"January 30, 2019","description":"不使用next.js，來試著依靠原生方法，架構出React server-side render，會使用到react官方的cli create-react-app，以及node.js作為server。","categories":"javascript","tags":["react.js","seo"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#181818","images":{"fallback":{"src":"/static/49f3722d7cadbd2be8eefba27f6a5890/b1838/react.png","srcSet":"/static/49f3722d7cadbd2be8eefba27f6a5890/caad8/react.png 183w,\n/static/49f3722d7cadbd2be8eefba27f6a5890/aef11/react.png 366w,\n/static/49f3722d7cadbd2be8eefba27f6a5890/b1838/react.png 732w","sizes":"(min-width: 732px) 732px, 100vw"},"sources":[{"srcSet":"/static/49f3722d7cadbd2be8eefba27f6a5890/305d6/react.webp 183w,\n/static/49f3722d7cadbd2be8eefba27f6a5890/12464/react.webp 366w,\n/static/49f3722d7cadbd2be8eefba27f6a5890/164a3/react.webp 732w","type":"image/webp","sizes":"(min-width: 732px) 732px, 100vw"}]},"width":1280,"height":657.4863387978141}}},"image":{"publicURL":"/static/49f3722d7cadbd2be8eefba27f6a5890/react.png"}}},"previous":{"fields":{"slug":"/2018-12-seoredirect/"},"frontmatter":{"title":"SEO 301、302轉址Redirect，canonical tag重複內容處理"}},"next":{"fields":{"slug":"/2019-02-promise/"},"frontmatter":{"title":"Javascript Promise example 簡易實作模擬"}}},"pageContext":{"id":"20d27da2-d557-5981-8a2d-bd1a2def444f","previousPostId":"9aaae7ce-759a-5217-9751-db71aa15ffe4","nextPostId":"62905755-12f0-5557-8492-102db86c5fad"}},"staticQueryHashes":["3649515864","3761976949","441988385"]}